<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="svgs/G.svg" />
    <title>GiB¬≤C - Que bicho √© esse?</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for general text, Poppins for titles if desired -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            flex-grow: 1;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* shadow-md */
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid transparent; /* For selected state */
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .card.selected {
            border-color: #2196F3; /* A color to indicate selection */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.15);
        }
        .icon-circle {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 2rem;
            color: white;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.2s;
        }
        .btn-primary {
            background-color: #4CAF50;
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #45a049;
            transform: translateY(-2px);
        }
        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .btn-secondary {
            background-color: #e0e0e0;
            color: #333;
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: #d4d4d4;
            transform: translateY(-2px);
        }

        /* Specific colors for environment cards */
        .card-marine .icon-circle { background-color: #90CAF9; } /* Light Blue */
        .card-soil .icon-circle { background-color: #FFCC80; } /* Light Orange */
        .card-cave .icon-circle { background-color: #A1887F; } /* Light Brown */
        .card-forest .icon-circle { background-color: #A5D6A7; } /* Light Green */

        /* Sequence puzzle specific styles */
        .dna-block {
            background-color: #E0E0E0;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer; /* Changed from grab to pointer */
            margin: 0.25rem;
            user-select: none;
            transition: background-color 0.2s;
        }
        .dna-block:hover {
            background-color: #D4D4D4;
        }
        .dna-block.correct {
            background-color: #A5D6A7; /* Light green for correct */
        }
        .dna-block.incorrect {
            background-color: #FFCDD2; /* Light red for incorrect */
        }
        .dna-block.placed { /* New class for blocks in target area */
            background-color: #D1E7DD; /* Light green-ish to show it's placed */
            cursor: pointer;
        }
        .dna-target-area {
            min-height: 80px;
            border: 2px dashed #9E9E9E;
            border-radius: 0.75rem;
            padding: 1rem;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            background-color: #F0F0F0;
        }
        .terminal-box {
            background-color: #2D2D2D;
            color: #E0E0E0;
            padding: 1.5rem;
            border-radius: 0.75rem;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.9rem;
            white-space: 'preserve nowrap';
            word-break: break-all;
            text-align: left;
        }
        .terminal-box .prompt {
            color: #C5E1A5; /* Light green */
        }
        .terminal-box .output {
            color: #90CAF9; /* Light blue */
        }
        .terminal-box .comment {
            color: #BDBDBD; /* Grey */
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 0.5rem;
            height: 1.5rem;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background-color: #4CAF50;
            border-radius: 0.5rem;
            transition: width 0.5s ease-out; /* Smooth transition for visual effect */
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #555;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
            .card {
                padding: 1rem;
            }
            .icon-circle {
                width: 3.5rem;
                height: 3.5rem;
                font-size: 1.75rem;
            }
            .container {
                padding: 1rem;
            }
            .dna-block {
                font-size: 0.8rem;
                padding: 0.4rem 0.6rem;
            }
            .terminal-box {
                font-size: 0.8rem;
            }
            .modal-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <!-- Main Header -->
    <header class="bg-white border-2 border-grey-100 text-white p-4 text-center">
        <h1 id="header-logo" class="text-2xl font-bold font-poppins cursor-pointer text-green-500">GiB¬≤C - Que bicho √© esse?</h1>
    </header>

    <!-- Main Content Area -->
    <main class="container flex-grow p-4 md:p-8 flex items-center justify-center">

        <!-- Screen: Home - Coleta -->
        <div id="screen-home" class="screen flex flex-col items-center justify-center w-full">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Onde voc√™ encontrou seu bicho?</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Selecione o ambiente de onde sua amostra foi coletada para iniciarmos o processo de identifica√ß√£o.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl">
                <div class="card card-marine" data-environment="ambienteMarinho">
                    <div class="icon-circle bg-blue-300">üêü</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Organismos marinhos</h3>
                    <p class="text-gray-500 text-sm">Peixes, algas, crust√°ceos e outros seres que vivem em ambientes aqu√°ticos.</p>
                </div>
                <div class="card card-soil" data-environment="ambienteSolo">
                    <div class="icon-circle bg-orange-300">üå±</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Organismos que vivem no solo</h3>
                    <p class="text-gray-500 text-sm">Minhocas, insetos, fungos e outros seres que habitam o ambiente terrestre.</p>
                </div>
                <div class="card card-cave" data-environment="ambienteCavernaFossil">
                    <div class="icon-circle bg-stone-500">ü¶¥</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Seres cavern√≠colas e f√≥sseis</h3>
                    <p class="text-gray-500 text-sm">Organismos adaptados √† vida em cavernas ou restos fossilizados.</p>
                </div>
                <div class="card card-forest" data-environment="ambienteFloresta">
                    <div class="icon-circle bg-green-300">üå≥</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Organismos que vivem em florestas</h3>
                    <p class="text-gray-500 text-sm">Mam√≠feros, aves, r√©pteis e outros seres que habitam ambientes florestais.</p>
                </div>
            </div>
        </div>

        <!-- Screen: Scan QR -->
        <div id="screen-scan-qr" class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Hora de sortear seu bicho!</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">V√° at√© a caixa f√≠sica do ambiente que voc√™ selecionou e retire um cart√£o. Em seguida, escaneie o QR Code!</p>
            <div class="bg-white p-8 rounded-xl shadow-lg flex flex-col items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-qr-code text-gray-500 mb-6"><rect width="5" height="5" x="3" y="3" rx="1"/><rect width="5" height="5" x="16" y="3" rx="1"/><rect width="5" height="5" x="3" y="16" rx="1"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21v.01"/><path d="M12 3v10a2 2 0 0 1-2 2H3"/><path d="M15 7h1"/></svg>
                <p class="text-lg text-gray-700">Aguardando escaneamento do QR Code...</p>
                <p class="text-sm text-gray-500 mt-2">A sequ√™ncia ser√° carregada automaticamente via URL.</p>
            </div>
            <p class="text-gray-500 text-xs mt-6 text-center max-w-md">Exemplo de URL do QR Code: `https://[seu-usuario].github.io/[seu-repo]/?seq=AACGTCATCCGG`</p>
            <button id="btn-back-to-home" class="btn btn-secondary mt-8 px-6 py-3 text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left inline-block mr-2"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                Voltar √† Tela Principal
            </button>
        </div>

        <!-- Screen: Sequence Display (Temporary) -->
        <div id="screen-sequence-display" class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Sua Sequ√™ncia!</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Observe e tente memorizar a sequ√™ncia para o pr√≥ximo passo!</p>
            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-3xl flex flex-col items-center">
                <div class="terminal-box w-full mb-6">
                    <span class="prompt">$ Analisando sequencia...</span>
                    <br>
                    <span id="display-sequence" class="output text-xl md:text-2xl font-bold tracking-wide"></span>
                </div>
                <div class="progress-bar-container w-full">
                    <div id="sequence-display-progress" class="progress-bar-fill"></div>
                </div>
                <p id="sequence-display-timer-text" class="text-gray-600 mt-4 text-center">Tempo restante: 5 segundos</p> <!-- Added text-center -->
            </div>
        </div>

        <!-- Screen: Sequencing the DNA (Loading) -->
        <div id="screen-sequencing" class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Sequenciando o DNA</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Nosso sequenciador est√° lendo o c√≥digo gen√©tico do seu organismo.</p>

            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-4xl flex flex-col md:flex-row items-center md:justify-around">
                <div class="flex flex-col items-center w-full md:w-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" width="150" height="150" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smartphone text-gray-400 mb-6"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>
                    <p class="text-lg text-gray-700 mb-4 text-center">O sequenciador est√° coletando informa√ß√µes gen√©ticas do seu organismo...</p>
                    <div class="progress-bar-container w-full md:w-80">
                        <div id="sequencing-progress" class="progress-bar-fill"></div>
                    </div>
                </div>
            </div>
            <button id="btn-sequencing-next" class="btn btn-primary mt-8 px-6 py-3 text-lg hidden">Ver sequ√™ncia ‚Üí</button>
        </div>

        <!-- Screen: Genome Assembly (Puzzle) -->
        <div id="screen-genome-assembly" class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Montando o Genoma</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">O c√≥digo gen√©tico do seu organismo foi revelado! Clique nos blocos na ordem correta para montar a sequ√™ncia.</p>

            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-3xl flex flex-col items-center">
                <div class="terminal-box w-full mb-6">
                    <span class="prompt">$ Analisando sequencia...</span>
                    <br>
                    <span class="prompt">$ iniciando montagem genoma...</span>
                    <br>
                    <span id="original-sequence-display" class="output text-xl md:text-2xl font-bold tracking-wide hidden"></span>
                </div>

                <button id="btn-show-sequence" class="btn btn-secondary mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye inline-block mr-2"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                    Consultar Sequ√™ncia (3s)
                </button>

                <div class="w-full mb-6 p-4 border-2 border-dashed border-gray-400 rounded-xl bg-gray-50">
                    <p class="text-gray-700 font-semibold mb-2 text-center">Monte a sequ√™ncia aqui:</p>
                    <div id="dna-target-area" class="dna-target-area w-full flex flex-wrap justify-center items-center p-2 bg-white rounded-lg min-h-[100px]">
                        <!-- Clicked DNA blocks will appear here -->
                    </div>
                </div>

                <div id="dna-blocks-source" class="flex flex-wrap justify-center gap-2 mb-6 p-4 bg-gray-100 rounded-xl w-full">
                    <!-- Shuffled DNA blocks will be injected here by JS -->
                </div>

                <button id="btn-check-assembly" class="btn btn-primary mt-4 px-6 py-3 text-lg">Verificar Montagem</button>
                <p id="assembly-message" class="text-center mt-4 font-semibold"></p>

                <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md mt-6 w-full" role="alert">
                    <div class="flex items-center">
                        <svg class="h-6 w-6 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-12a1 1 0 102 0V7a1 1 0 10-2 0v-1zm1 4a1 1 0 100 2h.01a1 1 0 100-2H10z" clip-rule="evenodd"></path>
                        </svg>
                        <p class="font-bold">Curiosidade gen√©tica</p>
                    </div>
                    <p class="text-sm mt-2">Cada organismo possui uma sequ√™ncia √∫nica de DNA que funciona como sua "impress√£o digital" gen√©tica.</p>
                </div>
            </div>
            <button id="btn-assembly-next" class="btn btn-primary mt-8 px-6 py-3 text-lg hidden">Consultar banco de dados ‚Üí</button>
        </div>

        <!-- Screen: Database Query -->
        <div id="screen-database-query" class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Consulta ao Banco de Dados</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Hora de descobrir quem √© seu bicho!</p>

            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-3xl flex flex-col items-center">
                <div id="db-processing-area" class="w-full min-h-[150px] bg-gray-50 rounded-xl p-6 flex flex-col items-center justify-center text-center text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-database text-gray-400 mb-4"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 12a9 3 0 0 0 18 0"/><path d="M3 5v14a9 3 0 0 0 18 0V5"/></svg>
                    <p id="db-status-text" class="text-lg">Iniciando a busca no banco de dados gen√¥mico...</p>
                    <p class="text-sm mt-2">O sistema ir√° comparar sua sequ√™ncia com milhares de registros em nosso banco de dados.</p>
                </div>
            </div>
            <button id="btn-db-next" class="btn btn-primary mt-8 px-6 py-3 text-lg hidden">Iniciar alinhamento ‚Üí</button>
        </div>

        <!-- Screen: Genetic Alignment -->
        <div id="screen-genetic-alignment" class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Alinhamento Gen√©tico</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Veja a rela√ß√£o de parentesco da sua amostra com outras esp√©cies!</p>

            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-4xl flex flex-col items-center">
                <div id="alignment-visualization" class="w-full space-y-4">
                    <!-- Dynamic alignment bars will be inserted here -->
                </div>
                <p id="alignment-summary" class="text-lg text-gray-700 mt-8 text-center"></p>
            </div>
            <button id="btn-alignment-next" class="btn btn-primary mt-8 px-6 py-3 text-lg">Ver Ficha Completa ‚Üí</button>
        </div>

        <!-- Screen: Identification Card -->
        <div id="screen-identification-card" class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Ficha de Identifica√ß√£o</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Bicho identificado! Conhe√ßa mais sobre este organismo.</p>

            <h3 id="card-animal-name" class="text-2xl font-bold text-white bg-blue-500 p-3 rounded-t-lg rounded-b-md mb-4"></h3>
            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-4xl grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded-lg">
                            <img id="card-animal-image" src="" alt="Animal Image" class="w-full h-auto max-h-64 object-contain rounded-lg">
                        </div>
                        <div class="text-gray-700">
                            <h4 class="font-bold text-lg mb-2">Descri√ß√£o</h4>
                            <p id="card-description" class="mb-4 text-sm"></p>
                            <h4 class="font-bold text-lg mb-2">Habitat e distribui√ß√£o</h4>
                            <p id="card-habitat" class="mb-4 text-sm"></p>
                        </div>
                    </div>
                    <div class="text-gray-700 mt-6">
                        <h4 class="font-bold text-lg mb-2">Caracter√≠sticas gen√©ticas</h4>
                        <p id="card-genetic-features" class="mb-4 text-sm"></p>
                    </div>
                </div>

                <div class="lg:col-span-1">
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <h4 class="font-bold text-lg mb-2">Classifica√ß√£o taxon√¥mica:</h4>
                        <ul class="text-gray-700 text-sm list-none p-0">
                            <li><strong class="text-gray-600">Reino:</strong> <span id="card-taxonomy-kingdom"></span></li>
                            <li><strong class="text-gray-600">Filo:</strong> <span id="card-taxonomy-phylum"></span></li>
                            <li><strong class="text-gray-600">Classe:</strong> <span id="card-taxonomy-class"></span></li>
                            <li><strong class="text-gray-600">Ordem:</strong> <span id="card-taxonomy-order"></span></li>
                            <li><strong class="text-gray-600">Fam√≠lia:</strong> <span id="card-taxonomy-family"></span></li>
                            <li><strong class="text-gray-600">G√™nero:</strong> <span id="card-taxonomy-genus"></span></li>
                            <li><strong class="text-gray-600">Esp√©cie:</strong> <span id="card-taxonomy-species"></span></li>
                        </ul>
                    </div>
                    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md" role="alert">
                        <div class="flex items-center mb-2">
                            <svg class="h-6 w-6 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-12a1 1 0 102 0V7a1 1 0 10-2 0v-1zm1 4a1 1 0 100 2h.01a1 1 0 100-2H10z" clip-rule="evenodd"></path>
                        </svg>
                        <p class="font-bold">Curiosidade</p>
                    </div>
                    <p id="card-curiosity" class="text-sm"></p>
                </div>
            </div>
        </div>
        <button id="btn-identify-another" class="btn btn-primary mt-8 px-6 py-3 text-lg">Identificar outro bicho</button>
    </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-2 mt-auto">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center text-center md:text-left text-sm">
            <div class="mb-4 md:mb-0">
                <h3 class="text-xl font-bold font-poppins mb-1">GiB¬≤C - UFF</h3>
                <p>Ferramenta educacional para identifica√ß√£o de esp√©cies</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-1 gap-4 md:gap-8">
                <div>
                    <h4 class="font-bold mb-2">Sobre</h4>
                    <ul>
                        <li>
                            <a href="https://gib2c.uff.br/" target="_blank" rel="noopener noreferrer" class="hover:text-gray-300 inline-flex items-center mb-1">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link ml-1"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg> -->
                                Equipe
                            </a>
                        </li>
                        <li>
                            <a href="https://www.instagram.com/gib2c/" target="_blank" rel="noopener noreferrer" class="hover:text-gray-300 inline-flex items-center mb-1">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-instagram ml-1"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg> -->
                                Instagram
                            </a>
                        </li>
                        <li><a href="#" id="privacy-policy-link" class="hover:text-gray-300 mb-1">Pol√≠tica de privacidade</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="mt-6 text-center text-xs text-gray-400">
            <p> GiB¬≤C - UFF | Ferramenta desenvolvida para fins educacionais.</p>
        </div>
    </footer>

    <!-- Privacy Policy Modal -->
    <div id="privacy-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="modal-close-btn">&times;</button>
            <h3 class="text-2xl font-bold font-poppins mb-4 text-gray-800">Pol√≠tica de Privacidade</h3>
            <p class="text-gray-700 text-sm text-justify">
                &nbsp;Esta aplica√ß√£o, "GiB¬≤C - UFF: Que bicho √© esse?", foi desenvolvida exclusivamente com <b>fins educacionais e de demonstra√ß√£o</b>.
                N√£o coletamos, armazenamos ou processamos quaisquer dados pessoais dos usu√°rios.
            </p>
            <br>
            <p class="text-gray-700 text-sm text-justify">
                &nbsp;Toda a intera√ß√£o ocorre localmente no seu navegador e n√£o h√° transmiss√£o de informa√ß√µes para servidores externos.
                As "sequ√™ncias de DNA" utilizadas s√£o fict√≠cias e servem apenas para simular o processo de bioinform√°tica de forma l√∫dica.
                Acreditamos que a privacidade √© fundamental, especialmente em ferramentas de aprendizado.
            </p>
            <button id="modal-understood-btn" class="btn btn-primary mt-6 w-full">Entendi!</button>
        </div>
    </div>

    <script>
        // Data for species - comprehensive for demonstration
        const speciesData = {
            "ambienteMarinho": [
                {
                    id: "peixe1", sequence: "AACGTCATCCGG", name: "Peixe-palha√ßo (Nemo)", scientificName: "Amphiprion ocellaris",
                    description: "Um peixe marinho vibrante conhecido por sua rela√ß√£o simbi√≥tica com an√©monas. Possui cores fortes de laranja, branco e preto.",
                    habitat: "Encontrado em recifes de coral no Oceano Pac√≠fico e √çndico, em √°guas rasas e protegidas.",
                    geneticFeatures: "Possui um genoma relativamente pequeno e √© um modelo de estudo para adapta√ß√£o a ambientes estressantes.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Actinopterygii", order: "Perciformes", family: "Pomacentridae", genus: "Amphiprion", species: "A. ocellaris" },
                    curiosity: "Todos nascem machos, mas o maior macho do grupo pode mudar para f√™mea se a f√™mea dominante morrer.",
                    image: "https://placehold.co/200x200/90CAF9/FFFFFF?text=Peixe+Palha√ßo"
                },
                {
                    id: "tubarao1", sequence: "GGCTAGCTAGTC", name: "Tubar√£o-martelo", scientificName: "Sphyrna mokarran",
                    description: "Um predador marinho com uma cabe√ßa distintiva em forma de T, que melhora sua vis√£o e detec√ß√£o de presas.",
                    habitat: "Encontrado em √°guas costeiras e oce√¢nicas tropicais e temperadas em todo o mundo.",
                    geneticFeatures: "Seu genoma apresenta adapta√ß√µes para a vida em oceano aberto e para a ca√ßa de grandes presas.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Chondrichthyes", order: "Carcharhiniformes", family: "Sphyrnidae", genus: "Sphyrna", species: "S. mokarran" },
                    curiosity: "Sua cabe√ßa em forma de martelo pode ajud√°-lo a 'prender' raias no fundo do oceano antes de atac√°-las.",
                    image: "https://placehold.co/200x200/90CAF9/FFFFFF?text=Tubarao+Martelo"
                },
                {
                    id: "baleia1", sequence: "ATCGATCGATCG", name: "Baleia-azul", scientificName: "Balaenoptera musculus",
                    description: "O maior animal do planeta, conhecido por seu tamanho colossal e sua dieta baseada em krill.",
                    habitat: "Habita todos os oceanos do mundo, migrando entre √°guas quentes e frias.",
                    geneticFeatures: "Seu genoma cont√©m informa√ß√µes cruciais sobre seu gigantismo e adapta√ß√µes ao ambiente marinho profundo.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Cetacea", family: "Balaenopteridae", genus: "Balaenoptera", species: "B. musculus" },
                    curiosity: "Sua l√≠ngua sozinha pode pesar tanto quanto um elefante, e seu cora√ß√£o √© do tamanho de um carro.",
                    image: "https://placehold.co/200x200/90CAF9/FFFFFF?text=Baleia+Azul"
                },
                {
                    id: "estrela1", sequence: "AGTCAGTCAGTC", name: "Estrela-do-mar", scientificName: "Asterias rubens",
                    description: "Um equinodermo marinho com simetria radial, capaz de regenerar membros perdidos.",
                    habitat: "Encontrada em leitos marinhos rochosos e arenosos, desde a zona entremar√©s at√© profundidades consider√°veis.",
                    geneticFeatures: "Seu genoma revela a base gen√©tica de sua impressionante capacidade de regenera√ß√£o e desenvolvimento.",
                    taxonomy: { kingdom: "Animalia", phylum: "Echinodermata", class: "Asteroidea", order: "Forcipulatida", family: "Asteriidae", genus: "Asterias", species: "A. rubens" },
                    curiosity: "N√£o s√£o peixes, apesar do nome, e movem-se usando milhares de pequenos p√©s tubulares em seus bra√ßos.",
                    image: "https://placehold.co/200x200/90CAF9/FFFFFF?text=Estrela+do+Mar"
                },
                {
                    id: "polvo1", sequence: "GCTAGCTAGGCA", name: "Polvo-comum", scientificName: "Octopus vulgaris",
                    description: "Um molusco cefal√≥pode altamente inteligente, conhecido por sua camuflagem e capacidade de resolver problemas.",
                    habitat: "Habita √°guas costeiras e subtropicais ao redor do mundo, em fundos rochosos e recifes.",
                    geneticFeatures: "Possui um genoma complexo que contribui para sua intelig√™ncia, camuflagem e sistema nervoso avan√ßado.",
                    taxonomy: { kingdom: "Animalia", phylum: "Mollusca", class: "Cephalopoda", order: "Octopoda", family: "Octopodidae", genus: "Octopus", species: "O. vulgaris" },
                    curiosity: "T√™m tr√™s cora√ß√µes: dois bombeiam sangue para as br√¢nquias, e um terceiro circula o sangue para o resto do corpo.",
                    image: "Images/Animals/Marinhos/Polvo-comum.png"
                },
                {
                    id: "cavalomarinho1", sequence: "TAGCTAGTAGTA", name: "Cavalo-marinho", scientificName: "Hippocampus hippocampus",
                    description: "Um peixe com uma forma corporal √∫nica e o macho incuba os ovos em uma bolsa especializada.",
                    habitat: "Encontrado em √°guas tropicais e temperadas, em leitos de ervas marinhas e recifes de coral.",
                    geneticFeatures: "Seu genoma oferece insights sobre a invers√£o de pap√©is parentais e sua morfologia incomum.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Actinopterygii", order: "Syngnathiformes", family: "Syngnathidae", genus: "Hippocampus", species: "H. hippocampus" },
                    curiosity: "S√£o os √∫nicos peixes onde o macho carrega os ovos, e podem mudar de cor para camuflagem.",
                    image: "https://placehold.co/200x200/90CAF9/FFFFFF?text=Cavalo+Marinho"
                },
                {
                    id: "medusa1", sequence: "CGTAGCGTAGGC", name: "Medusa-da-lua", scientificName: "Aurelia aurita",
                    description: "Uma esp√©cie de medusa com um corpo em forma de sino e quatro g√¥nadas em forma de ferradura vis√≠veis atrav√©s de seu corpo transl√∫cido.",
                    habitat: "Comum em √°guas costeiras temperadas e tropicais de todo o mundo.",
                    geneticFeatures: "Seu genoma simples, mas adapt√°vel, permite-lhe prosperar em diferentes condi√ß√µes oce√¢nicas.",
                    taxonomy: { kingdom: "Animalia", phylum: "Cnidaria", class: "Scyphozoa", order: "Semaeostomeae", family: "Ulmaridae", genus: "Aurelia", species: "A. aurita" },
                    curiosity: "N√£o t√™m c√©rebro, cora√ß√£o, ossos ou olhos, mas possuem uma rede nervosa primitiva.",
                    image: "https://placehold.co/200x200/90CAF9/FFFFFF?text=Medusa"
                },
                {
                    id: "golfinho1", sequence: "TCGATCGATTCG", name: "Golfinho-nariz-de-garrafa", scientificName: "Tursiops truncatus",
                    description: "Um mam√≠fero marinho altamente inteligente e social, conhecido por sua ecolocaliza√ß√£o e saltos acrob√°ticos.",
                    habitat: "Habita √°guas temperadas e tropicais em todo o mundo, tanto em zonas costeiras quanto em mar aberto.",
                    geneticFeatures: "Seu genoma complexo √© estudado por sua intelig√™ncia, comunica√ß√£o e adapta√ß√£o √† vida aqu√°tica.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Cetacea", family: "Delphinidae", genus: "Tursiops", species: "T. truncatus" },
                    curiosity: "S√£o capazes de usar ferramentas e t√™m culturas regionais, transmitindo conhecimentos entre gera√ß√µes.",
                    image: "https://placehold.co/200x200/90CAF9/FFFFFF?text=Golfinho"
                },
                {
                    id: "tartarugamarinha1", sequence: "GATCGATCGATC", name: "Tartaruga-marinha-verde", scientificName: "Chelonia mydas",
                    description: "Uma grande tartaruga marinha herb√≠vora, nomeada pela cor de sua gordura, e n√£o de sua carapa√ßa.",
                    habitat: "Encontrada em √°guas tropicais e subtropicais ao redor do mundo, alimentando-se em leitos de ervas marinhas e algas.",
                    geneticFeatures: "Seu genoma reflete sua longevidade, migra√ß√µes √©picas e adapta√ß√µes a uma dieta herb√≠vora marinha.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Reptilia", order: "Testudines", family: "Cheloniidae", genus: "Chelonia", species: "C. mydas" },
                    curiosity: "Pode prender a respira√ß√£o por horas submersa, e as f√™meas retornam √† mesma praia onde nasceram para botar ovos.",
                    image: "https://placehold.co/200x200/90CAF9/FFFFFF?text=Tartaruga+Marinha"
                },
                {
                    id: "coralarvore1", sequence: "ACTGACTGACTG", name: "Coral-c√©rebro", scientificName: "Diploria labyrinthiformis",
                    description: "Um tipo de coral que forma col√¥nias em formato de c√©rebro, com sulcos e cristas que se assemelham aos giros de um c√©rebro.",
                    habitat: "Cresce em recifes de coral em √°guas quentes e rasas do Atl√¢ntico, Caribe e Golfo do M√©xico.",
                    geneticFeatures: "Seu genoma revela a complexidade da forma√ß√£o de recifes e a simbiose com algas que o alimentam.",
                    taxonomy: { kingdom: "Animalia", phylum: "Cnidaria", class: "Anthozoa", order: "Scleractinia", family: "Mussidae", genus: "Diploria", species: "D. labyrinthiformis" },
                    curiosity: "S√£o essenciais para a forma√ß√£o de recifes de coral, fornecendo abrigo e alimento para in√∫meras esp√©cies marinhas.",
                    image: "https://placehold.co/200x200/90CAF9/FFFFFF?text=Coral+Cerebro"
                }
            ],
            "ambienteSolo": [
                {
                    id: "minhoca1", sequence: "CCTGATGCCTAG", name: "Minhoca-da-terra", scientificName: "Lumbricus terrestris",
                    description: "Um invertebrado segmentado que vive no solo, essencial para a sa√∫de do ecossistema.",
                    habitat: "Solos √∫midos e ricos em mat√©ria org√¢nica em todo o mundo.",
                    geneticFeatures: "Genoma simples, mas adaptado para a vida subterr√¢nea e decomposi√ß√£o.",
                    taxonomy: { kingdom: "Animalia", phylum: "Annelida", class: "Clitellata", order: "Crassiclitellata", family: "Lumbricidae", genus: "Lumbricus", species: "L. terrestris" },
                    curiosity: "N√£o t√™m olhos, mas podem sentir a luz e as vibra√ß√µes. S√£o hermafroditas, possuindo √≥rg√£os reprodutores masculinos e femininos.",
                    image: "https://placehold.co/200x200/FFCC80/000000?text=Minhoca"
                },
                {
                    id: "besouro1", sequence: "AAGCTGCTAGGT", name: "Besouro-rinoceronte", scientificName: "Dynastes hercules",
                    description: "Um dos maiores besouros do mundo, famoso por seu grande chifre. Os machos usam seus chifres em batalhas por f√™meas.",
                    habitat: "Florestas tropicais da Am√©rica Central e do Sul, vivendo na madeira em decomposi√ß√£o.",
                    geneticFeatures: "Seu genoma possui genes que controlam o desenvolvimento de seus chifres impressionantes.",
                    taxonomy: { kingdom: "Animalia", phylum: "Arthropoda", class: "Insecta", order: "Coleoptera", family: "Scarabaeidae", genus: "Dynastes", species: "D. hercules" },
                    curiosity: "Pode levantar at√© 850 vezes seu pr√≥prio peso, tornando-o um dos animais mais fortes do planeta em rela√ß√£o ao seu tamanho.",
                    image: "https://placehold.co/200x200/FFCC80/000000?text=Besouro"
                },
                {
                    id: "formiga1", sequence: "GATTACAACAAC", name: "Formiga-cortadeira", scientificName: "Atta cephalotes",
                    description: "Uma formiga social que 'cultiva' fungos para se alimentar, cortando folhas para fertiliz√°-los.",
                    habitat: "Florestas tropicais e subtropicais das Am√©ricas.",
                    geneticFeatures: "Genoma complexo que reflete sua organiza√ß√£o social avan√ßada e seu mutualismo com fungos.",
                    taxonomy: { kingdom: "Animalia", phylum: "Arthropoda", class: "Insecta", order: "Hymenoptera", family: "Formicidae", genus: "Atta", species: "A. cephalotes" },
                    curiosity: "S√£o agricultoras sofisticadas, usando folhas para cultivar seus pr√≥prios 'jardins' de fungos dentro do formigueiro.",
                    image: "https://placehold.co/200x200/FFCC80/000000?text=Formiga"
                },
                {
                    id: "fungo1", sequence: "TTGGCGTACGTA", name: "Cogumelo-da-morte", scientificName: "Amanita phalloides",
                    description: "Um fungo altamente t√≥xico, respons√°vel pela maioria das fatalidades por envenenamento por cogumelos.",
                    habitat: "Cresce em florestas, em simbiose com ra√≠zes de √°rvores como carvalhos e pinheiros.",
                    geneticFeatures: "Seu genoma cont√©m os genes respons√°veis pela produ√ß√£o de suas potentes toxinas.",
                    taxonomy: { kingdom: "Fungi", phylum: "Basidiomycota", class: "Agaricomycetes", order: "Agaricales", family: "Amanitaceae", genus: "Amanita", species: "A. phalloides" },
                    curiosity: "Apesar de seu nome, tem um sabor agrad√°vel, o que o torna ainda mais perigoso, pois as v√≠timas n√£o percebem o perigo at√© que seja tarde demais.",
                    image: "https://placehold.co/200x200/FFCC80/000000?text=Cogumelo"
                },
                {
                    id: "rato1", sequence: "CGTAGCGTAAGG", name: "Rato-dom√©stico", scientificName: "Mus musculus",
                    description: "Um pequeno mam√≠fero roedor, adapt√°vel e amplamente distribu√≠do, muitas vezes encontrado em ambientes humanos.",
                    habitat: "Ambientes variados, incluindo casas, fazendas e campos, adaptando-se facilmente √† presen√ßa humana.",
                    geneticFeatures: "√â um dos animais mais estudados geneticamente, sendo um modelo para a pesquisa biom√©dica devido √† sua similaridade gen√©tica com humanos.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Rodentia", family: "Muridae", genus: "Mus", species: "M. musculus" },
                    curiosity: "Seu genoma √© incrivelmente similar ao humano, e eles s√£o usados em pesquisas para entender doen√ßas e desenvolver tratamentos.",
                    image: "https://placehold.co/200x200/FFCC80/000000?text=Rato"
                },
                {
                    id: "cobra1", sequence: "TGCAGTCAGACT", name: "Cobra-cornuda", scientificName: "Vipera ammodytes",
                    description: "Uma v√≠bora venenosa encontrada na Europa, caracterizada por uma proemin√™ncia macia e escamosa no focinho.",
                    habitat: "Vive em √°reas rochosas, ensolaradas, encostas e matagais da Europa Central e Sudeste.",
                    geneticFeatures: "Seu genoma cont√©m informa√ß√µes sobre a produ√ß√£o de seu veneno e sua adapta√ß√£o a climas temperados.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Reptilia", order: "Squamata", family: "Viperidae", genus: "Vipera", species: "V. ammodytes" },
                    curiosity: "√â considerada a v√≠bora mais perigosa da Europa devido ao seu veneno potente e seu habitat pr√≥ximo a √°reas humanas.",
                    image: "https://placehold.co/200x200/FFCC80/000000?text=Cobra"
                },
                {
                    id: "lesma1", sequence: "GTTCAGTTGACA", name: "Lesma-cinzenta", scientificName: "Deroceras reticulatum",
                    description: "Um molusco gastr√≥pode terrestre, sem concha, conhecido por sua baba e h√°bito de se alimentar de plantas.",
                    habitat: "Jardins, campos e √°reas √∫midas e vegetadas em muitas partes do mundo.",
                    geneticFeatures: "Genoma que revela adapta√ß√µes para a vida terrestre sem concha e a produ√ß√£o de muco para locomo√ß√£o e prote√ß√£o.",
                    taxonomy: { kingdom: "Animalia", phylum: "Mollusca", class: "Gastropoda", order: "Stylommatophora", family: "Agriolimacidae", genus: "Deroceras", species: "D. reticulatum" },
                    curiosity: "A baba de lesma √© usada em algumas culturas como rem√©dio tradicional e para hidrata√ß√£o da pele.",
                    image: "https://placehold.co/200x200/FFCC80/000000?text=Lesma"
                },
                {
                    id: "aranha1", sequence: "CACGTAGTGGTA", name: "Aranha-teia-de-funil", scientificName: "Atrax robustus",
                    description: "Uma aranha altamente venenosa nativa da Austr√°lia, conhecida por seu habitat em forma de funil.",
                    habitat: "Regi√µes costeiras e montanhosas do leste da Austr√°lia, construindo teias em tocas e buracos.",
                    geneticFeatures: "Seu genoma cont√©m os genes respons√°veis pela produ√ß√£o de suas neurotoxinas potentes.",
                    taxonomy: { kingdom: "Animalia", phylum: "Arthropoda", class: "Arachnida", order: "Araneae", family: "Atracidae", genus: "Atrax", species: "A. robustus" },
                    curiosity: "√â uma das aranhas mais perigosas do mundo, mas um antiveneno eficaz foi desenvolvido na Austr√°lia.",
                    image: "Images/Animals/Solo/Aranha.png"
                },
                {
                    id: "coelho1", sequence: "GGCTAGCTATAG", name: "Coelho-europeu", scientificName: "Oryctolagus cuniculus",
                    description: "Um pequeno mam√≠fero herb√≠voro, social e prol√≠fico, que vive em tocas subterr√¢neas.",
                    habitat: "Campos abertos, florestas com clareiras e √°reas agr√≠colas em muitas partes do mundo.",
                    geneticFeatures: "Seu genoma √© estudado para entender sua adaptabilidade, reprodu√ß√£o r√°pida e resist√™ncia a doen√ßas.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Lagomorpha", family: "Leporidae", genus: "Oryctolagus", species: "O. cuniculus" },
                    curiosity: "Ao contr√°rio dos roedores, os coelhos t√™m um segundo par de incisivos menores atr√°s dos dentes da frente superiores.",
                    image: "https://placehold.co/200x200/FFCC80/000000?text=Coelho"
                }
            ],
            "ambienteCavernaFossil": [
                {
                    id: "morcego1", sequence: "CCTAGGTACGTA", name: "Morcego-cavern√≠cola", scientificName: "Myotis lucifugus",
                    description: "Um pequeno morcego que se abriga em cavernas durante o dia e emerge √† noite para ca√ßar insetos.",
                    habitat: "Cavernas, minas e estruturas escuras em florestas e √°reas rurais.",
                    geneticFeatures: "Genoma adaptado para a ecolocaliza√ß√£o e vida em ambientes escuros.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Chiroptera", family: "Vespertilionidae", genus: "Myotis", species: "M. lucifugus" },
                    curiosity: "Pode comer centenas de insetos em uma √∫nica noite, sendo um importante controlador de pragas.",
                    image: "https://placehold.co/200x200/A1887F/FFFFFF?text=Morcego"
                },
                {
                    id: "olmcave1", sequence: "GGCCTTAAGGTC", name: "Olm", scientificName: "Proteus anguinus",
                    description: "Um anf√≠bio aqu√°tico cego e com br√¢nquias externas, perfeitamente adaptado √† vida em cavernas escuras.",
                    habitat: "Sistema de cavernas c√°rsticas na Europa Central e Sudeste.",
                    geneticFeatures: "Genoma com adapta√ß√µes para cegueira, longevidade e metabolismo lento em ambientes de baixa energia.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Amphibia", order: "Caudata", family: "Proteidae", genus: "Proteus", species: "P. anguinus" },
                    curiosity: "Pode viver at√© 100 anos e sobreviver por uma d√©cada sem comida, devido ao seu metabolismo extremamente lento.",
                    image: "https://placehold.co/200x200/A1887F/FFFFFF?text=Olm"
                },
                {
                    id: "peixecaverna1", sequence: "TAGCTAGCAGTA", name: "Peixe-cego-de-caverna", scientificName: "Astyanax mexicanus",
                    description: "Uma subesp√©cie de peixe de √°gua doce que vive em cavernas, tendo perdido seus olhos e pigmenta√ß√£o ao longo da evolu√ß√£o.",
                    habitat: "Rios e piscinas subterr√¢neas em sistemas de cavernas no M√©xico e nos EUA.",
                    geneticFeatures: "Seu genoma apresenta muta√ß√µes que levaram √† perda de vis√£o e pigmenta√ß√£o em ambientes escuros.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Actinopterygii", order: "Characiformes", family: "Characidae", genus: "Astyanax", species: "A. mexicanus" },
                    curiosity: "Embora cegos, compensam com sentidos agu√ßados de tato e olfato para navegar em seus ambientes escuros.",
                    image: "https://placehold.co/200x200/A1887F/FFFFFF?text=Peixe+Caverna"
                },
                {
                    id: "aranhacaverna1", sequence: "ACGTACGTAGAT", name: "Aranha-de-caverna", scientificName: "Meta menardi",
                    description: "Uma aranha grande e escura que vive em ambientes √∫midos e escuros, como cavernas e t√∫neis.",
                    habitat: "Cavernas, minas e outras forma√ß√µes subterr√¢neas na Europa e Am√©rica do Norte.",
                    geneticFeatures: "Genoma com adapta√ß√µes para a vis√£o reduzida e maior sensibilidade a vibra√ß√µes.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Arachnida", order: "Araneae", family: "Tetragnathidae", genus: "Meta", species: "M. menardi" },
                    curiosity: "Seus olhos s√£o pequenos e pouco desenvolvidos, mas suas pernas longas e sens√≠veis a ajudam a detectar presas no escuro total.",
                    image: "Images/Animals/Solo/Aranha.png"
                },
                {
                    id: "griloCaverna1", sequence: "GCATGCATGCAT", name: "Grilo-de-caverna", scientificName: "Ceuthophilus stygius",
                    description: "Um grilo sem asas e de pernas longas, perfeitamente adaptado √† vida em cavernas e fendas.",
                    habitat: "Cavernas e habitats subterr√¢neos em regi√µes temperadas.",
                    geneticFeatures: "Genoma com adapta√ß√µes para sobreviver em ambientes com pouca comida e sem luz.",
                    taxonomy: { kingdom: "Animalia", phylum: "Arthropoda", class: "Insecta", order: "Orthoptera", family: "Rhaphidophoridae", genus: "Ceuthophilus", species: "C. stygius" },
                    curiosity: "S√£o conhecidos por sua capacidade de saltar longas dist√¢ncias, mesmo no escuro, para escapar de predadores.",
                    image: "https://placehold.co/200x200/A1887F/FFFFFF?text=Grilo+Caverna"
                },
                {
                    id: "estegossauro1", sequence: "TAGCTAGCTATC", name: "Estegossauro (F√≥ssil)", scientificName: "Stegosaurus stenops",
                    description: "Um dinossauro herb√≠voro do per√≠odo Jur√°ssico, famoso por suas grandes placas √≥sseas nas costas e espinhos na cauda.",
                    habitat: "Florestas e plan√≠cies na Am√©rica do Norte.",
                    geneticFeatures: "Seu genoma (hipot√©tico) conteria as instru√ß√µes para suas estruturas √≥sseas defensivas e tamanho massivo.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Reptilia", order: "Ornithischia", family: "Stegosauridae", genus: "Stegosaurus", species: "S. stenops" },
                    curiosity: "Apesar de seu corpo maci√ßo, seu c√©rebro era do tamanho de uma noz, o menor em propor√ß√£o ao corpo entre os dinossauros.",
                    image: "https://placehold.co/200x200/A1887F/FFFFFF?text=Estegossauro"
                },
                {
                    id: "mamute1", sequence: "CCTAGGCTAGTC", name: "Mamute-lanoso (F√≥ssil)", scientificName: "Mammuthus primigenius",
                    description: "Um elefante extinto da Idade do Gelo, coberto por uma espessa pelagem para se proteger do frio.",
                    habitat: "Estepes frias e tundras do Hemisf√©rio Norte.",
                    geneticFeatures: "Estudos de seu DNA recuperado de f√≥sseis revelam adapta√ß√µes ao frio extremo e sua dieta de gram√≠neas.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Proboscidea", family: "Elephantidae", genus: "Mammuthus", species: "M. primigenius" },
                    curiosity: "Os cientistas est√£o explorando a possibilidade de 'reviver' o mamute lanoso usando DNA antigo e t√©cnicas de clonagem.",
                    image: "https://placehold.co/200x200/A1887F/FFFFFF?text=Mamute"
                },
                {
                    id: "ammonite1", sequence: "AGTCGATCGGTC", name: "Amonite (F√≥ssil)", scientificName: "Ammonoidea",
                    description: "Um grupo extinto de moluscos cefal√≥podes marinhos com conchas espirais, parentes dos polvos e lulas atuais.",
                    habitat: "Oceanos pr√©-hist√≥ricos em todo o mundo.",
                    geneticFeatures: "F√≥sseis indicam uma grande diversidade de formas de concha, refletindo seu sucesso evolutivo.",
                    taxonomy: { kingdom: "Animalia", phylum: "Mollusca", class: "Cephalopoda", order: "Ammonoidea", family: "N/A", genus: "N/A", species: "N/A" },
                    curiosity: "S√£o excelentes f√≥sseis-guia, o que significa que sua presen√ßa em rochas ajuda a datar a idade dessas rochas.",
                    image: "https://placehold.co/200x200/A1887F/FFFFFF?text=Amonite"
                },
                {
                    id: "trilobite1", sequence: "GATCGACTGACT", name: "Trilobite (F√≥ssil)", scientificName: "Trilobita",
                    description: "Um grupo extinto de artr√≥podes marinhos, conhecidos por seus corpos segmentados divididos em tr√™s l√≥bulos.",
                    habitat: "Fundos oce√¢nicos de todo o mundo, desde o Cambriano at√© o Permiano.",
                    geneticFeatures: "Seus f√≥sseis detalhados fornecem informa√ß√µes sobre a evolu√ß√£o dos primeiros artr√≥podes.",
                    taxonomy: { kingdom: "Animalia", phylum: "Arthropoda", class: "Trilobita", order: "N/A", family: "N/A", genus: "N/A", species: "N/A" },
                    curiosity: "Foram um dos primeiros grupos de animais a desenvolver olhos complexos.",
                    image: "https://placehold.co/200x200/A1887F/FFFFFF?text=Trilobite"
                },
                {
                    id: "denteMega1", sequence: "ACTAGCTACTGA", name: "Dente de Megalodon (F√≥ssil)", scientificName: "Otodus megalodon",
                    description: "Um dente fossilizado do maior tubar√£o que j√° existiu, o Megalodon, um predador √°pice dos oceanos pr√©-hist√≥ricos.",
                    habitat: "Oceano global, ca√ßando grandes presas marinhas.",
                    geneticFeatures: "Embora o genoma completo seja desconhecido, seu tamanho massivo e dentes afiados indicam uma evolu√ß√£o predat√≥ria not√°vel.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Chondrichthyes", order: "Lamniformes", family: "Otodontidae", genus: "Otodus", species: "O. megalodon" },
                    curiosity: "Seus dentes podiam atingir mais de 18 cm de comprimento, sendo os maiores dentes de tubar√£o conhecidos.",
                    image: "https://placehold.co/200x200/A1887F/FFFFFF?text=Dente+Megalodon"
                }
            ],
            "ambienteFloresta": [
                {
                    id: "ovelha1", sequence: "AACGTCATCCGGTACTGGTCATAGCAATGCTAGGC", name: "Ovelha dom√©stica", scientificName: "Ovis aries",
                    description: "A ovelha dom√©stica (Ovis aries) √© um mam√≠fero ruminante herb√≠voro, que foi domesticado h√° aproximadamente 10.000 anos. √â um animal de m√©dio porte, coberto por uma espessa camada de l√£ que serve como isolante t√©rmico. Elas s√£o criadas principalmente por sua l√£, carne e leite.",
                    habitat: "Originalmente nativas da √Åsia e Europa, as ovelhas foram introduzidas em todos os continentes, exceto a Ant√°rtida. Adaptam-se bem a diversos ambientes, desde plan√≠cies at√© regi√µes montanhosas, mas preferem pastagens abertas.",
                    geneticFeatures: "O genoma da ovelha dom√©stica cont√©m 27 pares de cromossomos. Seu DNA possui sequ√™ncias espec√≠ficas que a distinguem de outros animais, mesmo daqueles evolutivamente pr√≥ximos, como cabras e bovinos. A an√°lise gen√©tica ajuda a entender suas caracter√≠sticas de produ√ß√£o e resist√™ncia a doen√ßas.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Artiodactyla", family: "Bovidae", genus: "Ovis", species: "O. aries" },
                    curiosity: "As ovelhas t√™m uma vis√£o perif√©rica de aproximadamente 270 a 320 graus, permitindo que vejam atr√°s de si sem virar a cabe√ßa! Al√©m disso, possuem um est√¥mago dividido em quatro compartimentos que lhes permite digerir alimentos que outros animais n√£o conseguem.",
                    image: "Images/Animals/Floresta/ovelha.png"
                },
                {
                    id: "onca1", sequence: "TGCATGCTAGCA", name: "On√ßa-pintada", scientificName: "Panthera onca",
                    description: "O maior felino das Am√©ricas, conhecido por sua pelagem manchada e sua for√ßa de mordida excepcional.",
                    habitat: "Florestas tropicais, p√¢ntanos e √°reas arborizadas da Am√©rica Central e do Sul.",
                    geneticFeatures: "Genoma com adapta√ß√µes para sua dieta carn√≠vora e sua distribui√ß√£o geogr√°fica variada.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Carnivora", family: "Felidae", genus: "Panthera", species: "P. onca" },
                    curiosity: "√â um excelente nadador e ca√ßa na √°gua, sendo uma das poucas esp√©cies de grandes felinos que gostam de nadar.",
                    image: "https://placehold.co/200x200/A5D6A7/000000?text=Onca+Pintada"
                },
                {
                    id: "macaco1", sequence: "GCTAGCAGTTAA", name: "Macaco-aranha", scientificName: "Ateles paniscus",
                    description: "Um primata com bra√ßos e pernas longos e uma cauda pre√™nsil, adaptado √† vida nas √°rvores.",
                    habitat: "Florestas tropicais √∫midas da Am√©rica do Sul.",
                    geneticFeatures: "Seu genoma reflete sua arboricidade e dieta frug√≠vora, al√©m de sua complexa estrutura social.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Primates", family: "Atelidae", genus: "Ateles", species: "A. paniscus" },
                    curiosity: "Sua cauda √© t√£o forte e √°gil que funciona como um quinto membro, permitindo-lhe balan√ßar entre as √°rvores com facilidade.",
                    image: "https://placehold.co/200x200/A5D6A7/000000?text=Macaco+Aranha"
                },
                {
                    id: "tucano1", sequence: "CATGCATGCCCG", name: "Tucano-de-bico-arco-√≠ris", scientificName: "Ramphastos sulfuratus",
                    description: "Uma ave colorida com um bico grande e vibrante, habitante das florestas tropicais.",
                    habitat: "Florestas tropicais e subtropicais do M√©xico ao norte da Col√¥mbia.",
                    geneticFeatures: "Seu genoma √© estudado por seus genes de colora√ß√£o e adapta√ß√µes diet√©ticas (frutos).",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Aves", order: "Piciformes", family: "Ramphastidae", genus: "Ramphastos", species: "R. sulfuratus" },
                    curiosity: "Apesar do tamanho, o bico do tucano √© surpreendentemente leve, feito de uma estrutura esponjosa de queratina.",
                    image: "https://placehold.co/200x200/A5D6A7/000000?text=Tucano"
                },
                {
                    id: "arara1", sequence: "CATGCATGCCGT", name: "Arara-azul", scientificName: "Anodorhynchus hyacinthinus",
                    description: "A maior arara do mundo, conhecida por sua plumagem azul-cobalto brilhante e seu bico poderoso.",
                    habitat: "Florestas √∫midas, savanas e √°reas abertas com palmeiras, principalmente no Pantanal.",
                    geneticFeatures: "Seu genoma oferece insights sobre sua longevidade, intelig√™ncia e dieta especializada (cocos de palmeira).",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Aves", order: "Psittaciformes", family: "Psittacidae", genus: "Anodorhynchus", species: "A. hyacinthinus" },
                    curiosity: "Seu bico √© t√£o forte que pode quebrar nozes de palmeira com facilidade, um alimento que poucas outras aves conseguem acessar.",
                    image: "https://placehold.co/200x200/A5D6A7/000000?text=Arara+Azul"
                },
                {
                    id: "sapo1", sequence: "GCTAGTAGTAGC", name: "Sapo-cururu", scientificName: "Rhinella marina",
                    description: "Um grande sapo terrestre com pele verrugosa e gl√¢ndulas de veneno proeminentes, nativo das Am√©ricas.",
                    habitat: "Florestas, campos e jardins em regi√µes tropicais e subtropicais.",
                    geneticFeatures: "Seu genoma possui genes relacionados √† produ√ß√£o de toxinas para defesa contra predadores.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Amphibia", order: "Anura", family: "Bufonidae", genus: "Rhinella", species: "R. marina" },
                    curiosity: "√â uma esp√©cie invasora em muitas partes do mundo, como a Austr√°lia, onde causa grandes impactos ambientais devido √† sua toxicidade.",
                    image: "https://placehold.co/200x200/A5D6A7/000000?text=Sapo+Cururu"
                },
                {
                    id: "tamandua1", sequence: "TAGCTAGATGCA", name: "Tamandu√°-bandeira", scientificName: "Myrmecophaga tridactyla",
                    description: "Um mam√≠fero de grande porte com um focinho alongado, adaptado para se alimentar de formigas e cupins.",
                    habitat: "Savanas, campos e florestas abertas na Am√©rica Central e do Sul.",
                    geneticFeatures: "Seu genoma revela adapta√ß√µes para sua dieta inset√≠vora e sua l√≠ngua longa e pegajosa.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Pilosa", family: "Myrmecophagidae", genus: "Myrmecophaga", species: "M. tridactyla" },
                    curiosity: "Sua l√≠ngua pode ter at√© 60 cm de comprimento e pode estic√°-la e retra√≠-la at√© 150 vezes por minuto.",
                    image: "https://placehold.co/200x200/A5D6A7/000000?text=Tamandua"
                },
                {
                    id: "bichoPre1", sequence: "ACGTACGTACGT", name: "Bicho-pregui√ßa", scientificName: "Bradypus variegatus",
                    description: "Um mam√≠fero arb√≥reo conhecido por seu metabolismo extremamente lento e movimentos pausados.",
                    habitat: "Florestas tropicais da Am√©rica Central e do Sul.",
                    geneticFeatures: "Genoma com adapta√ß√µes para sua dieta de folhas de baixo valor nutricional e seu estilo de vida de baixo gasto energ√©tico.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Pilosa", family: "Bradypodidae", genus: "Bradypus", species: "B. variegatus" },
                    curiosity: "Seu pelo abriga algas e insetos, fornecendo camuflagem e nutrientes extras.",
                    image: "https://placehold.co/200x200/A5D6A7/000000?text=Bicho+Preguica"
                },
                {
                    id: "jaguarundi1", sequence: "GTCAGTCAGTGC", name: "Jaguarundi", scientificName: "Herpailurus yagouaroundi",
                    description: "Um felino pequeno e esguio, de cor uniforme, que se assemelha a uma doninha, diferentemente de outros felinos manchados.",
                    habitat: "Florestas, matagais e √°reas semi-abertas da Am√©rica do Norte e do Sul.",
                    geneticFeatures: "Seu genoma reflete sua adaptabilidade a diferentes habitats e sua dieta variada.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Carnivora", family: "Felidae", genus: "Herpailurus", species: "H. yagouaroundi" },
                    curiosity: "Ao contr√°rio da maioria dos felinos, o jaguarundi √© mais ativo durante o dia (diurno).",
                    image: "https://placehold.co/200x200/A5D6A7/000000?text=Jaguarundi"
                },
                {
                    id: "capivara1", sequence: "TCGATCGTCAGT", name: "Capivara", scientificName: "Hydrochoerus hydrochaeris",
                    description: "O maior roedor do mundo, semi-aqu√°tico, com corpo robusto e membranas interdigitais nos p√©s.",
                    habitat: "√Åreas pr√≥ximas a rios, lagos e p√¢ntanos na Am√©rica do Sul.",
                    geneticFeatures: "Seu genoma cont√©m adapta√ß√µes para sua vida semi-aqu√°tica e sua dieta herb√≠vora.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Mammalia", order: "Rodentia", family: "Caviidae", genus: "Hydrochoerus", species: "H. hydrochaeris" },
                    curiosity: "S√£o animais muito sociais, vivendo em grupos grandes e s√£o excelentes nadadoras, podendo permanecer submersas por v√°rios minutos.",
                    image: "https://placehold.co/200x200/A5D6A7/000000?text=Capivara"
                },
                {
                    id: "aguia1", sequence: "CATGCATGCATG", name: "√Åguia-real", scientificName: "Aquila chrysaetos",
                    description: "Uma das maiores aves de rapina do mundo, conhecida por sua vis√£o agu√ßada e sua habilidade de ca√ßa.",
                    habitat: "Montanhas, colinas e √°reas abertas com florestas em todo o Hemisf√©rio Norte.",
                    geneticFeatures: "Seu genoma revela genes relacionados √† vis√£o de alta acuidade e for√ßa muscular para voo e ca√ßa.",
                    taxonomy: { kingdom: "Animalia", phylum: "Chordata", class: "Aves", order: "Accipitriformes", family: "Accipitridae", genus: "Aquila", species: "A. chrysaetos" },
                    curiosity: "√â capaz de ver uma lebre a mais de 3 km de dist√¢ncia e pode voar em altitudes muito elevadas.",
                    image: "Images/Animals/Floresta/√Åguia-real.png" 
                }
            ]
        };

        let currentScreen = '';
        let currentSequence = '';
        let identifiedAnimal = null;
        let identifiedEnvironment = null; // Store the identified animal's environment

        const screens = {
            home: document.getElementById('screen-home'),
            scanQr: document.getElementById('screen-scan-qr'),
            sequenceDisplay: document.getElementById('screen-sequence-display'),
            sequencing: document.getElementById('screen-sequencing'),
            genomeAssembly: document.getElementById('screen-genome-assembly'),
            databaseQuery: document.getElementById('screen-database-query'),
            geneticAlignment: document.getElementById('screen-genetic-alignment'),
            identificationCard: document.getElementById('screen-identification-card')
        };

        // --- Utility Functions ---
        function showScreen(screenId) {
            // Hide all screens
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            // Show the target screen
            screens[screenId].classList.remove('hidden');
            currentScreen = screenId;
        }

        function getQueryParams() {
            const params = {};
            window.location.search.substring(1).split('&').forEach(param => {
                const parts = param.split('=');
                if (parts.length === 2) {
                    params[parts[0]] = decodeURIComponent(parts[1]);
                }
            });
            return params;
        }

        function formatSequence(sequence) {
            // Formats sequence into blocks of 3 for readability
            if (!sequence) return '';
            return sequence.match(/.{1,3}/g).join(' ');
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function findAnimalBySequence(sequence) {
            for (const env in speciesData) {
                const animal = speciesData[env].find(a => a.sequence === sequence);
                if (animal) {
                    identifiedEnvironment = env; // Store the environment
                    return animal;
                }
            }
            return null; // No animal found with this sequence
        }

        // Simple sequence similarity calculation (placeholder for actual bioinformatics)
        function calculateSimilarity(seq1, seq2) {
            if (seq1.length !== seq2.length) return 0;
            let matches = 0;
            for (let i = 0; i < seq1.length; i++) {
                if (seq1[i] === seq2[i]) {
                    matches++;
                }
            }
            return (matches / seq1.length) * 100;
        }


        // --- Screen Logic ---

        // Make header logo clickable to go to home and clear URL
        document.getElementById('header-logo').addEventListener('click', () => {
            currentSequence = '';
            identifiedAnimal = null;
            identifiedEnvironment = null;
            window.history.pushState({}, document.title, window.location.pathname); // Clear URL params
            showScreen('home');
        });

        // Screen: Home (Coleta)
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('click', () => {
                // Remove selected class from all cards
                document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
                // Add selected class to the clicked card
                card.classList.add('selected');

                // Transition to Scan QR screen
                showScreen('scanQr');
            });
        });

        // Back button on Scan QR screen
        document.getElementById('btn-back-to-home').addEventListener('click', () => {
            showScreen('home');
        });


        // Screen: Sequence Display
        function startSequenceDisplay(sequence) {
            currentSequence = sequence; // Store the sequence globally
            document.getElementById('display-sequence').textContent = formatSequence(sequence);
            const progressBar = document.getElementById('sequence-display-progress');
            const timerText = document.getElementById('sequence-display-timer-text');
            const duration = 15; // seconds
            let timeLeft = duration;
            progressBar.style.width = '0%';
            timerText.textContent = `Tempo restante: ${timeLeft} segundos`;

            let startTime = Date.now();
            const interval = setInterval(() => {
                const elapsedTime = (Date.now() - startTime) / 1000;
                const progress = (elapsedTime / duration) * 100;
                progressBar.style.width = `${progress}%`;
                timeLeft = Math.max(0, duration - Math.floor(elapsedTime));
                timerText.textContent = `Tempo restante: ${timeLeft} segundos`;

                if (elapsedTime >= duration) {
                    clearInterval(interval);
                    // Transition to sequencing screen after display
                    showScreen('sequencing');
                    startSequencingProcess(); // Start the sequencing animation
                }
            }, 150);
        }

        // Screen: Sequencing the DNA
        function startSequencingProcess() {
            const progressBar = document.getElementById('sequencing-progress');
            const nextButton = document.getElementById('btn-sequencing-next');
            progressBar.style.width = '0%'; // Reset
            nextButton.classList.add('hidden'); // Hide button initially

            let progress = 0;
            const interval = setInterval(() => {
                progress += 2; // Increment progress
                progressBar.style.width = `${progress}%`;
                if (progress >= 100) {
                    clearInterval(interval);
                    nextButton.classList.remove('hidden'); // Show button when complete
                }
            }, 25); // Adjust interval for desired speed

            nextButton.onclick = () => {
                showScreen('genomeAssembly');
                setupGenomeAssemblyPuzzle(currentSequence);
            };
        }

        // Screen: Genome Assembly (Puzzle)
        let originalSequenceBlocks = [];
        let assembledBlocks = [];
        let sequenceDisplayTimeout = null; // To clear timeout if needed

        // Event handler for clicking DNA blocks (both source and target)
        function handleDnaBlockClick(event) {
            const clickedBlock = event.target;
            const blockValue = clickedBlock.textContent;
            const originalIndex = parseInt(clickedBlock.dataset.originalIndex);

            const sourceArea = document.getElementById('dna-blocks-source');
            const targetArea = document.getElementById('dna-target-area');

            if (clickedBlock.parentElement === sourceArea) {
                // Move from source to target
                if (targetArea.querySelector('p')) { // Remove placeholder if exists
                    targetArea.innerHTML = '';
                }
                targetArea.appendChild(clickedBlock);
                assembledBlocks.push(blockValue); // Add to assembled blocks
                clickedBlock.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                clickedBlock.classList.add('bg-gray-100', 'dna-block-placed'); // Indicate it's placed
                clickedBlock.classList.add('placed'); // Add new class for styling
            } else if (clickedBlock.parentElement === targetArea) {
                // Move from target back to source
                sourceArea.appendChild(clickedBlock); // Append first, then reorder
                
                // Remove from assembledBlocks
                const indexToRemove = assembledBlocks.indexOf(blockValue);
                if (indexToRemove > -1) {
                    assembledBlocks.splice(indexToRemove, 1);
                }

                clickedBlock.classList.remove('bg-gray-100', 'dna-block-placed', 'placed', 'correct', 'incorrect'); // Clear placed/feedback styles
                clickedBlock.classList.add('bg-gray-200', 'hover:bg-gray-300');

                // Reorder blocks in source area based on original index
                const sourceBlocks = Array.from(sourceArea.children);
                sourceBlocks.sort((a, b) => parseInt(a.dataset.originalIndex) - parseInt(b.dataset.originalIndex));
                sourceBlocks.forEach(block => sourceArea.appendChild(block)); // Re-append in sorted order

                if (targetArea.children.length === 0) { // Add placeholder back if target area is empty
                    targetArea.innerHTML = '<p class="text-gray-400 text-center text-sm">Monte a sequ√™ncia aqui:</p>';
                }
            }
            // Update assembledBlocks to reflect current state of targetArea
            assembledBlocks = Array.from(targetArea.querySelectorAll('.dna-block')).map(block => block.textContent);
        }

        function setupGenomeAssemblyPuzzle(sequence) {
            const sequenceDiv = document.getElementById('original-sequence-display');
            sequenceDiv.textContent = formatSequence(sequence); // Still set for when it's revealed

            originalSequenceBlocks = sequence.match(/.{1,3}/g); // Break into 3-char blocks
            const shuffledBlocks = shuffleArray([...originalSequenceBlocks]); // Copy and shuffle

            const sourceArea = document.getElementById('dna-blocks-source');
            sourceArea.innerHTML = ''; // Clear previous blocks
            assembledBlocks = []; // Reset assembled blocks

            shuffledBlocks.forEach((block, index) => {
                const dnaBlock = document.createElement('div');
                dnaBlock.classList.add('dna-block', 'px-3', 'py-2', 'rounded-lg', 'bg-gray-200', 'hover:bg-gray-300', 'transition-colors', 'select-none');
                dnaBlock.textContent = block;
                dnaBlock.dataset.originalIndex = index; // Store original index
                dnaBlock.id = `block-${index}`; // Keep ID for reference
                sourceArea.appendChild(dnaBlock);

                dnaBlock.addEventListener('click', handleDnaBlockClick); // Add click listener
            });

            const targetArea = document.getElementById('dna-target-area');
            targetArea.innerHTML = '<p class="text-gray-400 text-center text-sm">Monte a sequ√™ncia aqui:</p>'; // Placeholder
            targetArea.classList.remove('border-green-500', 'border-red-500'); // Reset border color
            
            // Remove previous click handlers from target area and its children if any
            targetArea.removeEventListener('click', handleDnaBlockClick); // If any direct listener was added

            document.getElementById('btn-check-assembly').onclick = checkGenomeAssembly;
            document.getElementById('btn-assembly-next').classList.add('hidden');
            document.getElementById('assembly-message').textContent = '';

            // Logic for "Consultar Sequ√™ncia" button
            const showSequenceBtn = document.getElementById('btn-show-sequence');
            showSequenceBtn.onclick = () => {
                const seqDisplay = document.getElementById('original-sequence-display');
                seqDisplay.classList.remove('hidden');
                showSequenceBtn.disabled = true; // Disable button while sequence is visible

                if (sequenceDisplayTimeout) {
                    clearTimeout(sequenceDisplayTimeout);
                }
                sequenceDisplayTimeout = setTimeout(() => {
                    seqDisplay.classList.add('hidden');
                    showSequenceBtn.disabled = false; // Re-enable button
                }, 3000); // 3 seconds
            };
        }

        function checkGenomeAssembly() {
            const assembledSequence = assembledBlocks.join('');
            const originalFullSequence = originalSequenceBlocks.join('');
            const messageElement = document.getElementById('assembly-message');
            const nextButton = document.getElementById('btn-assembly-next');
            const targetArea = document.getElementById('dna-target-area');

            // Reset block colors
            targetArea.querySelectorAll('.dna-block').forEach(block => {
                block.classList.remove('correct', 'incorrect');
            });

            if (assembledSequence === originalFullSequence) {
                messageElement.textContent = 'Montagem correta! üéâ';
                messageElement.classList.remove('text-red-600');
                messageElement.classList.add('text-green-600');
                nextButton.classList.remove('hidden');

                // Mark blocks as correct
                targetArea.querySelectorAll('.dna-block').forEach(block => {
                    block.classList.add('correct');
                });

            } else {
                messageElement.textContent = 'Montagem incorreta. Tente novamente.';
                messageElement.classList.remove('text-green-600');
                messageElement.classList.add('text-red-600');
                nextButton.classList.add('hidden');

                // Provide feedback on incorrect blocks (simple, based on position)
                const targetBlocks = targetArea.querySelectorAll('.dna-block');
                for (let i = 0; i < assembledBlocks.length; i++) {
                    if (originalSequenceBlocks[i] && assembledBlocks[i] !== originalSequenceBlocks[i]) {
                        targetBlocks[i].classList.add('incorrect');
                    } else if (originalSequenceBlocks[i]) {
                        targetBlocks[i].classList.add('correct');
                    }
                }
            }
        }

        document.getElementById('btn-assembly-next').onclick = () => {
            showScreen('databaseQuery');
            startDatabaseQueryProcess(); // Start the database query automatically
        };

        // Screen: Database Query - Modified for automatic processing
        function startDatabaseQueryProcess() {
            const dbStatusText = document.getElementById('db-status-text');
            const dbProcessingArea = document.getElementById('db-processing-area');
            const nextButton = document.getElementById('btn-db-next');

            dbStatusText.textContent = 'Processando dados e comparando com registros no banco...';
            dbProcessingArea.classList.remove('bg-green-50', 'bg-red-50', 'bg-gray-50');
            dbProcessingArea.innerHTML = `
                <svg class="animate-spin h-10 w-10 text-green-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-lg text-gray-700">Buscando no banco de dados gen√¥mico...</p>
            `;
            nextButton.classList.add('hidden');

            // Simulate network request/processing time
            setTimeout(() => {
                identifiedAnimal = findAnimalBySequence(currentSequence);
                if (identifiedAnimal) {
                    dbProcessingArea.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle text-green-500 mb-4"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
                        <p class="text-lg text-green-700">Sequ√™ncia encontrada! Pronto para o alinhamento.</p>
                    `;
                    dbProcessingArea.classList.add('bg-green-50');
                    nextButton.classList.remove('hidden');
                } else {
                    dbProcessingArea.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-circle text-red-500 mb-4"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                        <p class="text-lg text-red-700">Sequ√™ncia n√£o encontrada em nosso banco. Tente outra!</p>
                    `;
                    dbProcessingArea.classList.add('bg-red-50');
                    nextButton.classList.add('hidden'); // Ensure button is hidden if not found
                }
            }, 3000); // Simulate 3 seconds of processing
        }

        document.getElementById('btn-db-next').onclick = () => {
            showScreen('geneticAlignment');
            setupGeneticAlignment(identifiedAnimal);
        };

        // Screen: Genetic Alignment - Modified for environment-specific similarity
        function setupGeneticAlignment(animal) {
            const visualizationArea = document.getElementById('alignment-visualization');
            const summaryText = document.getElementById('alignment-summary');
            visualizationArea.innerHTML = '';
            summaryText.textContent = '';

            if (!animal || !identifiedEnvironment) {
                summaryText.textContent = 'Nenhum animal identificado ou ambiente selecionado para alinhamento.';
                return;
            }

            const animalsInSameEnvironment = speciesData[identifiedEnvironment];
            let similarSpecies = [];

            // Add the identified animal itself
            similarSpecies.push({
                name: animal.name,
                similarity: 100,
                isUserAnimal: true,
                sequence: animal.sequence
            });

            // Calculate similarity with other animals in the same environment
            animalsInSameEnvironment.forEach(otherAnimal => {
                if (otherAnimal.id !== animal.id) { // Don't compare with itself again
                    const similarity = calculateSimilarity(animal.sequence, otherAnimal.sequence);
                    // Ensure a plausible range for similarity for educational purposes
                    const displayedSimilarity = Math.max(50, Math.round(similarity + (Math.random() * 20 - 10))); // Add some randomness for variety
                    similarSpecies.push({
                        name: otherAnimal.name,
                        similarity: displayedSimilarity,
                        isUserAnimal: false,
                        sequence: otherAnimal.sequence
                    });
                }
            });

            // Sort by similarity descending
            similarSpecies.sort((a, b) => b.similarity - a.similarity);

            // Limit to top N similar species for visualization if too many
            const displayLimit = 5; // Adjust as needed
            similarSpecies = similarSpecies.slice(0, displayLimit);


            similarSpecies.forEach(s => {
                const barContainer = document.createElement('div');
                barContainer.classList.add('flex', 'items-center', 'mb-2');
                const nameSpan = document.createElement('span');
                nameSpan.classList.add('w-40', 'text-gray-700', 'font-medium', 'text-right', 'mr-4');
                nameSpan.textContent = s.name + ':';
                barContainer.appendChild(nameSpan);

                const progressBarWrapper = document.createElement('div');
                progressBarWrapper.classList.add('flex-grow', 'bg-gray-200', 'rounded-full', 'h-4', 'overflow-hidden');
                const progressBarFill = document.createElement('div');
                progressBarFill.classList.add('h-full', 'rounded-full', 'transition-all', 'duration-1000', 'ease-out');
                progressBarFill.style.width = `${s.similarity}%`;
                progressBarFill.style.backgroundColor = s.isUserAnimal ? '#4CAF50' : '#2196F3'; // Green for user animal, blue for others
                progressBarWrapper.appendChild(progressBarFill);
                barContainer.appendChild(progressBarWrapper);

                const percentageSpan = document.createElement('span');
                percentageSpan.classList.add('ml-4', 'text-gray-700', 'font-bold', 'w-12');
                percentageSpan.textContent = `${s.similarity.toFixed(0)}%`; // Display as integer percentage
                barContainer.appendChild(percentageSpan);

                visualizationArea.appendChild(barContainer);
            });

            summaryText.textContent = `O sistema encontrou que sua sequ√™ncia √© ${animal.similarity || 100}% similar √† esp√©cie ${animal.name}, indicando um forte parentesco gen√©tico. Explore outras similaridades abaixo!`;
        }

        document.getElementById('btn-alignment-next').onclick = () => {
            showScreen('identificationCard');
            displayIdentificationCard(identifiedAnimal);
        };

        // Screen: Identification Card
        function displayIdentificationCard(animal) {
            if (!animal) return;

            document.getElementById('card-animal-name').textContent = `${animal.name} (${animal.scientificName})`;
            document.getElementById('card-animal-image').src = animal.image;
            document.getElementById('card-animal-image').onerror = function() { this.src = 'https://placehold.co/200x200/CCCCCC/666666?text=Imagem+N/A'; }; // Fallback image
            document.getElementById('card-description').textContent = animal.description;
            document.getElementById('card-habitat').textContent = animal.habitat;
            document.getElementById('card-genetic-features').textContent = animal.geneticFeatures;
            document.getElementById('card-curiosity').textContent = animal.curiosity;

            // Taxonomy
            document.getElementById('card-taxonomy-kingdom').textContent = animal.taxonomy.kingdom;
            document.getElementById('card-taxonomy-phylum').textContent = animal.taxonomy.phylum;
            document.getElementById('card-taxonomy-class').textContent = animal.taxonomy.class;
            document.getElementById('card-taxonomy-order').textContent = animal.taxonomy.order;
            document.getElementById('card-taxonomy-family').textContent = animal.taxonomy.family;
            document.getElementById('card-taxonomy-genus').textContent = animal.taxonomy.genus;
            document.getElementById('card-taxonomy-species').textContent = animal.taxonomy.species;
        }

        document.getElementById('btn-identify-another').onclick = () => {
            // Reset game state and go back to QR scan screen
            currentSequence = '';
            identifiedAnimal = null;
            identifiedEnvironment = null;
            window.history.pushState({}, document.title, window.location.pathname); // Clear URL params
            showScreen('scanQr');
        };

        // Privacy Policy Modal Logic
        const privacyModal = document.getElementById('privacy-modal');
        const privacyLink = document.getElementById('privacy-policy-link');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalUnderstoodBtn = document.getElementById('modal-understood-btn');

        privacyLink.addEventListener('click', (e) => {
            e.preventDefault(); // Prevent default link behavior
            privacyModal.classList.remove('hidden');
        });

        modalCloseBtn.addEventListener('click', () => {
            privacyModal.classList.add('hidden');
        });

        modalUnderstoodBtn.addEventListener('click', () => {
            privacyModal.classList.add('hidden');
        });

        // Close modal if click outside content (optional)
        privacyModal.addEventListener('click', (e) => {
            if (e.target === privacyModal) {
                privacyModal.classList.add('hidden');
            }
        });


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            const params = getQueryParams();
            if (params.seq) {
                // If sequence is in URL, start game from sequence display
                showScreen('sequenceDisplay');
                startSequenceDisplay(params.seq.toUpperCase()); // Ensure uppercase for consistency
            } else {
                // Otherwise, start from the home screen
                showScreen('home');
            }
        });
    </script>
</body>
</html>
