<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="svgs/G.svg" />
    <title>GiB¬≤C - Que bicho √© esse?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap"
        rel="stylesheet">


</head>

<body class="flex flex-col min-h-screen">
    <header class="bg-white border-2 border-grey-100 text-white p-4 text-center">
        <h1 id="header-logo" class="text-2xl font-bold font-poppins cursor-pointer text-green-500">GiB¬≤C - Que bicho √©
            esse?</h1>
    </header>

    <main class="container flex-grow p-4 md:p-8 flex items-center justify-center">

        <!-- Screen: Home - Coleta -->
        <div id="screen-home" class="screen flex flex-col items-center justify-center w-full">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Onde voc√™ encontrou seu bicho?
            </h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Selecione o ambiente de onde sua amostra foi coletada
                para iniciarmos o processo de identifica√ß√£o.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl">
                <div class="card card-marine" data-environment="ambienteMarinho">
                    <div class="icon-circle bg-blue-300">üêü</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Organismos marinhos</h3>
                    <p class="text-gray-500 text-sm">Peixes, algas, crust√°ceos e outros seres que vivem em ambientes
                        aqu√°ticos.</p>
                </div>
                <div class="card card-soil" data-environment="ambienteSolo">
                    <div class="icon-circle bg-orange-300">üå±</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Organismos que vivem no solo</h3>
                    <p class="text-gray-500 text-sm">Minhocas, insetos, fungos e outros seres que habitam o ambiente
                        terrestre.</p>
                </div>
                <div class="card card-cave" data-environment="ambienteCavernaFossil">
                    <div class="icon-circle bg-stone-500">ü¶¥</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Seres cavern√≠colas e f√≥sseis</h3>
                    <p class="text-gray-500 text-sm">Organismos adaptados √† vida em cavernas ou restos fossilizados.</p>
                </div>
                <div class="card card-forest" data-environment="ambienteFloresta">
                    <div class="icon-circle bg-green-300">üå≥</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Organismos que vivem em florestas</h3>
                    <p class="text-gray-500 text-sm">Mam√≠feros, aves, r√©pteis e outros seres que habitam ambientes
                        florestais.</p>
                </div>
            </div>
        </div>

        <!-- Screen: Scan QR -->
        <div id="screen-scan-qr" class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Hora de sortear seu bicho!</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">V√° at√© a caixa f√≠sica do ambiente que voc√™ selecionou e
                retire um cart√£o. Em seguida, escaneie o QR Code!</p>
            <div class="bg-white p-8 rounded-xl shadow-lg flex flex-col items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-qr-code text-gray-500 mb-6">
                    <rect width="5" height="5" x="3" y="3" rx="1" />
                    <rect width="5" height="5" x="16" y="3" rx="1" />
                    <rect width="5" height="5" x="3" y="16" rx="1" />
                    <path d="M21 16h-3a2 2 0 0 0-2 2v3" />
                    <path d="M21 21v.01" />
                    <path d="M12 3v10a2 2 0 0 1-2 2H3" />
                    <path d="M15 7h1" />
                </svg>
                <p class="text-lg text-gray-700">Aguardando escaneamento do QR Code...</p>
                <p class="text-sm text-gray-500 mt-2">A sequ√™ncia ser√° carregada automaticamente.</p>
            </div>
            <!-- <p class="text-gray-500 text-xs mt-6 text-center max-w-md">Exemplo de URL do QR Code: `https://johkempo.github.io/GibC-Que_Bicho_e_esse/?seq=AACGTCATCCGG`</p> -->
            <button id="btn-back-to-home" class="btn btn-secondary mt-8 px-6 py-3 text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-arrow-left inline-block mr-2">
                    <path d="m12 19-7-7 7-7" />
                    <path d="M19 12H5" />
                </svg>
                Voltar √† Tela Principal
            </button>
        </div>


        <!-- Screen: Intro -->
        <div id="screen-intro-sequence" class="screen hidden flex flex-col items-center justify-center w-full p-4">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Sequ√™ncia de DNA Obtida!</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">
                A sequ√™ncia de DNA √© como uma "impress√£o digital" gen√©tica do seu bicho. A seguir, vamos revelar essa
                sequ√™ncia para voc√™. Tente memoriz√°-la, pois voc√™ precisar√° dela no pr√≥ximo passo!
            </p>
            <div class="bg-white p-8 rounded-xl shadow-lg flex flex-col items-center justify-center md:p-8">
                <svg fill="#69B988FF" height="120px" width="120px" version="1.1" id="Layer_1"
                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"
                    xml:space="preserve" transform="rotate(0)" stroke="#36ec7c">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC"
                        stroke-width="1.024"></g>
                    <g id="SVGRepo_iconCarrier">
                        <g>
                            <g>
                                <path
                                    d="M413.876,34.73c0-19.151-15.579-34.73-34.729-34.73s-34.73,15.579-34.73,34.73c0,10.532-1.455,21.047-4.131,31.564 H171.685c-1.797-7.109-3.038-14.23-3.651-21.365h111.425c5.633,0,10.199-4.566,10.199-10.199c0-5.633-4.566-10.199-10.199-10.199 H166.055C161.686,10.342,148.457,0,132.854,0c-19.15,0-34.73,15.579-34.73,34.73c0,80.895,52.403,151.003,112.129,221.269 C152.28,324.16,98.124,395.274,98.124,477.27c0,19.15,15.579,34.73,34.73,34.73c14.823,0,27.501-9.338,32.476-22.438h181.339 c4.975,13.1,17.653,22.438,32.476,22.438c19.15,0,34.73-15.579,34.73-34.73c0-81.081-52.47-151.094-112.129-221.269 C359.721,187.84,413.876,116.726,413.876,34.73z M333.626,86.693c-2.959,7.47-6.47,14.947-10.444,22.438h-134.46 c-3.958-7.475-7.455-14.952-10.408-22.438H333.626z M215.876,151.968c-5.418-7.484-10.532-14.962-15.263-22.438H311.29 c-4.718,7.458-9.827,14.935-15.249,22.438H215.876z M280.638,172.367c-7.843,9.999-16.116,20.054-24.64,30.179 c-8.501-10.087-16.796-20.142-24.688-30.179H280.638z M118.523,34.73c0-7.902,6.43-14.332,14.332-14.332 c7.903,0,14.332,6.43,14.332,14.332c0,45.56,22.593,88.815,53.954,131.649c0.593,1.304,1.451,2.458,2.508,3.399 c12.033,16.193,25.266,32.335,38.956,48.524c-4.276,4.994-8.591,10.005-12.924,15.039c-1.996,2.318-3.994,4.64-5.992,6.963 C167.41,173.897,118.523,107.878,118.523,34.73z M147.186,477.27c0.001,7.902-6.429,14.332-14.332,14.332 c-7.902,0-14.332-6.43-14.332-14.332c0-83.55,64.368-158.316,126.617-230.62c61.544-71.485,119.674-139.007,119.674-211.919 c0-7.902,6.43-14.332,14.332-14.332c7.902,0,14.332,6.43,14.332,14.332c0,83.55-64.368,158.316-126.617,230.62 C205.317,336.836,147.186,404.358,147.186,477.27z M199.4,384.563c4.647-7.459,9.691-14.936,15.057-22.438h83.181 c5.362,7.483,10.41,14.961,15.069,22.438H199.4z M324.376,404.961c3.871,7.474,7.275,14.952,10.126,22.438H177.567 c2.857-7.471,6.268-14.948,10.155-22.438H324.376z M229.725,341.726c8.326-10.689,17.158-21.44,26.278-32.271 c9.092,10.788,17.949,21.54,26.328,32.271H229.725z M167.876,469.163c0.494-7.125,1.624-14.245,3.325-21.365h169.63 c1.686,7.109,2.813,14.229,3.304,21.365H167.876z M393.478,477.27c0,7.902-6.43,14.332-14.332,14.332 c-7.903,0-14.332-6.43-14.332-14.332c0-64.023-44.589-123.461-95.418-183.571c4.276-4.994,8.592-10.005,12.924-15.039 c1.996-2.318,3.994-4.64,5.993-6.964C344.529,338.013,393.478,403.95,393.478,477.27z">
                                </path>
                            </g>
                        </g>
                        <g>
                            <g>
                                <path
                                    d="M319.236,24.531h-5.1c-5.633,0-10.199,4.566-10.199,10.199c0,5.633,4.566,10.199,10.199,10.199h5.1 c5.633,0,10.199-4.566,10.199-10.199C329.435,29.097,324.869,24.531,319.236,24.531z">
                                </path>
                            </g>
                        </g>
                    </g>
                </svg>
                <br>
                <p class="text-lg text-gray-700">Prepare-se para visualizar o c√≥digo gen√©tico.</p>
            </div>
            <button id="btn-start-viewing-sequence" class="btn btn-primary mt-8 px-6 py-3 text-lg">
                Revelar Sequ√™ncia ‚Üí
            </button>
        </div>

        <!-- Screen: Sequence Display (Temporary) -->
        <div id="screen-sequence-display"
            class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Sua Sequ√™ncia!</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Observe e tente memorizar a sequ√™ncia para o pr√≥ximo
                passo!</p>
            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-3xl flex flex-col items-center">
                <div class="terminal-box w-full mb-6">
                    <span class="prompt">$ Analisando sequencia...</span>
                    <br>
                    <span id="display-sequence" class="output text-xl md:text-2xl font-bold tracking-wide"></span>
                </div>
                <div class="progress-bar-container w-full">
                    <div id="sequence-display-progress" class="progress-bar-fill"></div>
                </div>
                <p id="sequence-display-timer-text" class="text-gray-600 mt-4 text-center">Tempo restante: 5 segundos
                </p> <!-- Added text-center -->
            </div>
        </div>

        <!-- Screen: Sequencing the DNA (Loading) -->
        <div id="screen-sequencing" class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Sequenciando o DNA</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Nosso sequenciador est√° lendo o c√≥digo gen√©tico do seu
                organismo.</p>

            <div
                class="bg-white p-8 rounded-xl shadow-lg w-full max-w-4xl flex flex-col md:flex-row items-center md:justify-around">
                <div class="flex flex-col items-center w-full md:w-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" width="150" height="150" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-smartphone text-gray-400 mb-6">
                        <rect width="14" height="20" x="5" y="2" rx="2" ry="2" />
                        <path d="M12 18h.01" />
                    </svg>
                    <p class="text-lg text-gray-700 mb-4 text-center">O sequenciador est√° coletando informa√ß√µes
                        gen√©ticas do seu organismo...</p>
                    <div class="progress-bar-container w-full md:w-80">
                        <div id="sequencing-progress" class="progress-bar-fill"></div>
                    </div>
                </div>
            </div>
            <button id="btn-sequencing-next" class="btn btn-primary mt-8 px-6 py-3 text-lg hidden">Ver sequ√™ncia
                ‚Üí</button>
        </div>

        <!-- Screen: Genome Assembly (Puzzle) -->
        <div id="screen-genome-assembly"
            class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Montando o Genoma</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">O c√≥digo gen√©tico do seu organismo foi revelado! Clique
                nos blocos na ordem correta para montar a sequ√™ncia.</p>

            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-3xl flex flex-col items-center">
                <div class="terminal-box w-full mb-6">
                    <span class="prompt">$ Analisando sequencia...</span>
                    <br>
                    <span class="prompt">$ iniciando montagem genoma...</span>
                    <br>
                    <span id="original-sequence-display"
                        class="output text-xl md:text-2xl font-bold tracking-wide hidden"></span>
                </div>

                <button id="btn-show-sequence" class="btn btn-secondary mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-eye inline-block mr-2">
                        <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                    Consultar Sequ√™ncia (3s)
                </button>

                <div class="w-full mb-6 p-4 border-2 border-dashed border-gray-400 rounded-xl bg-gray-50">
                    <p class="text-gray-700 font-semibold mb-2 text-center">Monte a sequ√™ncia aqui:</p>
                    <div id="dna-target-area"
                        class="dna-target-area w-full flex flex-wrap justify-center items-center p-2 bg-white rounded-lg min-h-[100px]">
                        <!-- Clicked DNA blocks will appear here -->
                    </div>
                </div>

                <div id="dna-blocks-source"
                    class="flex flex-wrap justify-center gap-2 mb-6 p-4 bg-gray-100 rounded-xl w-full">
                    <!-- Shuffled DNA blocks will be injected here by JS -->
                </div>

                <button id="btn-check-assembly" class="btn btn-primary mt-4 px-6 py-3 text-lg">Verificar
                    Montagem</button>
                <p id="assembly-message" class="text-center mt-4 font-semibold"></p>

                <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md mt-6 w-full"
                    role="alert">
                    <div class="flex items-center">
                        <svg class="h-6 w-6 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-12a1 1 0 102 0V7a1 1 0 10-2 0v-1zm1 4a1 1 0 100 2h.01a1 1 0 100-2H10z"
                                clip-rule="evenodd"></path>
                        </svg>
                        <p class="font-bold">Curiosidade gen√©tica</p>
                    </div>
                    <p class="text-sm mt-2">Cada organismo possui uma sequ√™ncia √∫nica de DNA que funciona como sua
                        "impress√£o digital" gen√©tica.</p>
                </div>
            </div>
            <button id="btn-assembly-next" class="btn btn-primary mt-8 px-6 py-3 text-lg hidden">Consultar banco de
                dados ‚Üí</button>
        </div>

        <!-- Screen: Database Query -->
        <div id="screen-database-query"
            class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Consulta ao Banco de Dados</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Hora de descobrir quem √© seu bicho!</p>

            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-3xl flex flex-col items-center">
                <div id="db-processing-area"
                    class="w-full min-h-[150px] bg-gray-50 rounded-xl p-6 flex flex-col items-center justify-center text-center text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-database text-gray-400 mb-4">
                        <ellipse cx="12" cy="5" rx="9" ry="3" />
                        <path d="M3 12a9 3 0 0 0 18 0" />
                        <path d="M3 5v14a9 3 0 0 0 18 0V5" />
                    </svg>
                    <p id="db-status-text" class="text-lg">Iniciando a busca no banco de dados gen√¥mico...</p>
                    <p class="text-sm mt-2">O sistema ir√° comparar sua sequ√™ncia com milhares de registros em nosso
                        banco de dados.</p>
                </div>
            </div>
            <button id="btn-db-next" class="btn btn-primary mt-8 px-6 py-3 text-lg hidden">Iniciar alinhamento
                ‚Üí</button>
        </div>

        <!-- Screen: Genetic Alignment -->
        <div id="screen-genetic-alignment"
            class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Alinhamento Gen√©tico</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Veja a rela√ß√£o de parentesco da sua amostra com outras
                esp√©cies!</p>

            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-4xl flex flex-col items-center">
                <div id="alignment-visualization" class="w-full space-y-4">
                    <!-- Dynamic alignment bars will be inserted here -->
                </div>
                <p id="alignment-summary" class="text-lg text-gray-700 mt-8 text-center"></p>
            </div>
            <button id="btn-alignment-next" class="btn btn-primary mt-8 px-6 py-3 text-lg">Ver Ficha Completa ‚Üí</button>
        </div>

        <!-- Screen: Identification Card -->
        <div id="screen-identification-card"
            class="screen hidden flex flex-col items-center justify-center w-full p-4 md:p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-poppins text-center">Ficha de Identifica√ß√£o</h2>
            <p class="text-gray-600 mb-8 text-center max-w-2xl">Bicho identificado! Conhe√ßa mais sobre este organismo.
            </p>

            <h3 id="card-animal-name"
                class="text-2xl font-bold text-white bg-blue-500 p-3 rounded-t-lg rounded-b-md mb-4"></h3>
            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-4xl grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded-lg">
                            <img id="card-animal-image" src="" alt="Animal Image"
                                class="w-full h-auto max-h-64 object-contain rounded-lg">
                        </div>
                        <div class="text-gray-700">
                            <h4 class="font-bold text-lg mb-2">Descri√ß√£o</h4>
                            <p id="card-description" class="mb-4 text-sm"></p>
                            <h4 class="font-bold text-lg mb-2">Habitat e distribui√ß√£o</h4>
                            <p id="card-habitat" class="mb-4 text-sm"></p>
                        </div>
                    </div>
                    <div class="text-gray-700 mt-6">
                        <h4 class="font-bold text-lg mb-2">Caracter√≠sticas gen√©ticas</h4>
                        <p id="card-genetic-features" class="mb-4 text-sm"></p>
                    </div>
                </div>

                <div class="lg:col-span-1">
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <h4 class="font-bold text-lg mb-2">Classifica√ß√£o taxon√¥mica:</h4>
                        <ul class="text-gray-700 text-sm list-none p-0">
                            <li><strong class="text-gray-600">Reino:</strong> <span id="card-taxonomy-kingdom"></span>
                            </li>
                            <li><strong class="text-gray-600">Filo:</strong> <span id="card-taxonomy-phylum"></span>
                            </li>
                            <li><strong class="text-gray-600">Classe:</strong> <span id="card-taxonomy-class"></span>
                            </li>
                            <li><strong class="text-gray-600">Ordem:</strong> <span id="card-taxonomy-order"></span>
                            </li>
                            <li><strong class="text-gray-600">Fam√≠lia:</strong> <span id="card-taxonomy-family"></span>
                            </li>
                            <li><strong class="text-gray-600">G√™nero:</strong> <span id="card-taxonomy-genus"></span>
                            </li>
                            <li><strong class="text-gray-600">Esp√©cie:</strong> <span id="card-taxonomy-species"></span>
                            </li>
                        </ul>
                    </div>
                    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md" role="alert">
                        <div class="flex items-center mb-2">
                            <svg class="h-6 w-6 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-12a1 1 0 102 0V7a1 1 0 10-2 0v-1zm1 4a1 1 0 100 2h.01a1 1 0 100-2H10z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            <p class="font-bold">Curiosidade</p>
                        </div>
                        <p id="card-curiosity" class="text-sm"></p>
                    </div>
                </div>
            </div>
            <button id="btn-identify-another" class="btn btn-primary mt-8 px-6 py-3 text-lg">Identificar outro
                bicho</button>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-2 mt-auto">
        <div
            class="container mx-auto flex flex-col md:flex-row justify-between items-center text-center md:text-left text-sm">
            <div class="mb-4 md:mb-0">
                <h3 class="text-xl font-bold font-poppins mb-1">GiB¬≤C - UFF</h3>
                <p>Ferramenta educacional para identifica√ß√£o de esp√©cies</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-1 gap-4 md:gap-8">
                <div>
                    <h4 class="font-bold mb-2">Sobre</h4>
                    <ul>
                        <li>
                            <a href="https://gib2c.uff.br/" target="_blank" rel="noopener noreferrer"
                                class="hover:text-gray-300 inline-flex items-center mb-1">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link ml-1"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg> -->
                                Equipe
                            </a>
                        </li>
                        <li>
                            <a href="https://www.instagram.com/gib2c/" target="_blank" rel="noopener noreferrer"
                                class="hover:text-gray-300 inline-flex items-center mb-1">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-instagram ml-1"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg> -->
                                Instagram
                            </a>
                        </li>
                        <li><a href="#" id="privacy-policy-link" class="hover:text-gray-300 mb-1">Pol√≠tica de
                                privacidade</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="mt-6 text-center text-xs text-gray-400">
            <p> GiB¬≤C - UFF | Ferramenta desenvolvida para fins educacionais.</p>
        </div>
    </footer>

    <!-- Privacy Policy Modal -->
    <div id="privacy-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="modal-close-btn">&times;</button>
            <h3 class="text-2xl font-bold font-poppins mb-4 text-gray-800">Pol√≠tica de Privacidade</h3>
            <p class="text-gray-700 text-sm text-justify">
                &nbsp;Esta aplica√ß√£o, "GiB¬≤C - UFF: Que bicho √© esse?", foi desenvolvida exclusivamente com <b>fins
                    educacionais e de demonstra√ß√£o</b>.
                N√£o coletamos, armazenamos ou processamos quaisquer dados pessoais dos usu√°rios.
            </p>
            <br>
            <p class="text-gray-700 text-sm text-justify">
                &nbsp;Toda a intera√ß√£o ocorre localmente no seu navegador e n√£o h√° transmiss√£o de informa√ß√µes para
                servidores externos.
                As "sequ√™ncias de DNA" utilizadas s√£o fict√≠cias e servem apenas para simular o processo de
                bioinform√°tica de forma l√∫dica.
                Acreditamos que a privacidade √© fundamental, especialmente em ferramentas de aprendizado.
            </p>
            <button id="modal-understood-btn" class="btn btn-primary mt-6 w-full">Entendi!</button>
        </div>
    </div>

    <script>
        let speciesData = {};
        
        let currentScreen = '';
        let currentSequence = '';
        let identifiedAnimal = null;
        let identifiedEnvironment = null;

        const screens = {
            home: document.getElementById('screen-home'),
            scanQr: document.getElementById('screen-scan-qr'),
            introSequence: document.getElementById('screen-intro-sequence'),
            sequenceDisplay: document.getElementById('screen-sequence-display'),
            sequencing: document.getElementById('screen-sequencing'),
            genomeAssembly: document.getElementById('screen-genome-assembly'),
            databaseQuery: document.getElementById('screen-database-query'),
            geneticAlignment: document.getElementById('screen-genetic-alignment'),
            identificationCard: document.getElementById('screen-identification-card')
        };

        // --- Utility Functions ---
        function showScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            screens[screenId].classList.remove('hidden');
            currentScreen = screenId;
        }

        function getQueryParams() {
            const params = {};
            window.location.search.substring(1).split('&').forEach(param => {
                const parts = param.split('=');
                if (parts.length === 2) {
                    params[parts[0]] = decodeURIComponent(parts[1]);
                }
            });
            return params;
        }

        function formatSequence(sequence) {
            if (!sequence) return '';
            return sequence.match(/.{1,3}/g).join(' ');
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function findAnimalBySequence(sequence) {
            for (const env in speciesData) {
                const animal = speciesData[env].find(a => a.sequence === sequence);
                if (animal) {
                    identifiedEnvironment = env; 
                    return animal;
                }
            }
            return null; 
        }

        
        function calculateSimilarity(seq1, seq2) {
            if (seq1.length !== seq2.length) return 0;
            let matches = 0;
            for (let i = 0; i < seq1.length; i++) {
                if (seq1[i] === seq2[i]) {
                    matches++;
                }
            }
            return (matches / seq1.length) * 100;
        }


        // --- Screen Logic ---

        // Make header logo clickable to go to home and clear URL
        document.getElementById('header-logo').addEventListener('click', () => {
            currentSequence = '';
            identifiedAnimal = null;
            identifiedEnvironment = null;
            window.history.pushState({}, document.title, window.location.pathname); // Clear URL params
            showScreen('home');
        });

        // Screen: Home (Coleta)
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');

                showScreen('scanQr');
            });
        });

        // Back button on Scan QR screen
        document.getElementById('btn-back-to-home').addEventListener('click', () => {
            showScreen('home');
        });

        // Evento para o bot√£o  tela de introdu√ß√£o
        document.getElementById('btn-start-viewing-sequence').onclick = () => {
            showScreen('sequenceDisplay');
            startSequenceDisplay(currentSequence); 
        };


        // Screen: Sequence Display
        function startSequenceDisplay(sequence) {
            currentSequence = sequence; 
            document.getElementById('display-sequence').textContent = formatSequence(sequence);
            const progressBar = document.getElementById('sequence-display-progress');
            const timerText = document.getElementById('sequence-display-timer-text');
            const duration = 15; 
            let timeLeft = duration;
            progressBar.style.width = '0%';
            timerText.textContent = `Tempo restante: ${timeLeft} segundos`;

            let startTime = Date.now();
            const interval = setInterval(() => {
                const elapsedTime = (Date.now() - startTime) / 1000;
                const progress = (elapsedTime / duration) * 100;
                progressBar.style.width = `${progress}%`;
                timeLeft = Math.max(0, duration - Math.floor(elapsedTime));
                timerText.textContent = `Tempo restante: ${timeLeft} segundos`;

                if (elapsedTime >= duration) {
                    clearInterval(interval);
                    showScreen('sequencing');
                    startSequencingProcess(); 
                }
            }, 150);
        }

        // Screen: Sequencing the DNA
        function startSequencingProcess() {
            const progressBar = document.getElementById('sequencing-progress');
            const nextButton = document.getElementById('btn-sequencing-next');
            progressBar.style.width = '0%'; 
            nextButton.classList.add('hidden'); 

            let progress = 0;
            const interval = setInterval(() => {
                progress += 2; 
                progressBar.style.width = `${progress}%`;
                if (progress >= 100) {
                    clearInterval(interval);
                    nextButton.classList.remove('hidden'); 
                }
            }, 25); 

            nextButton.onclick = () => {
                showScreen('genomeAssembly');
                setupGenomeAssemblyPuzzle(currentSequence);
            };
        }

        // Screen: Genome Assembly (Puzzle)
        let originalSequenceBlocks = [];
        let assembledBlocks = [];
        let sequenceDisplayTimeout = null; 

        // Event handler for clicking DNA blocks (both source and target)
        function handleDnaBlockClick(event) {
            const clickedBlock = event.target;
            const blockValue = clickedBlock.textContent;
            const originalIndex = parseInt(clickedBlock.dataset.originalIndex);

            const sourceArea = document.getElementById('dna-blocks-source');
            const targetArea = document.getElementById('dna-target-area');

            if (clickedBlock.parentElement === sourceArea) {
                if (targetArea.querySelector('p')) { 
                    targetArea.innerHTML = '';
                }
                targetArea.appendChild(clickedBlock);
                assembledBlocks.push(blockValue); 
                clickedBlock.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                clickedBlock.classList.add('bg-gray-100', 'dna-block-placed'); 
                clickedBlock.classList.add('placed'); 
            } else if (clickedBlock.parentElement === targetArea) {
                sourceArea.appendChild(clickedBlock); 

                const indexToRemove = assembledBlocks.indexOf(blockValue);
                if (indexToRemove > -1) {
                    assembledBlocks.splice(indexToRemove, 1);
                }

                clickedBlock.classList.remove('bg-gray-100', 'dna-block-placed', 'placed', 'correct', 'incorrect'); 
                clickedBlock.classList.add('bg-gray-200', 'hover:bg-gray-300');

                // Reorder blocks in source area based on original index
                const sourceBlocks = Array.from(sourceArea.children);
                sourceBlocks.sort((a, b) => parseInt(a.dataset.originalIndex) - parseInt(b.dataset.originalIndex));
                sourceBlocks.forEach(block => sourceArea.appendChild(block)); 

                if (targetArea.children.length === 0) { 
                    targetArea.innerHTML = '<p class="text-gray-400 text-center text-sm">Monte a sequ√™ncia aqui:</p>';
                }
            }
            // Update assembledBlocks to reflect current state of targetArea
            assembledBlocks = Array.from(targetArea.querySelectorAll('.dna-block')).map(block => block.textContent);
        }

        function setupGenomeAssemblyPuzzle(sequence) {
            const sequenceDiv = document.getElementById('original-sequence-display');
            sequenceDiv.textContent = formatSequence(sequence); 

            originalSequenceBlocks = sequence.match(/.{1,3}/g); 
            const shuffledBlocks = shuffleArray([...originalSequenceBlocks]); 

            const sourceArea = document.getElementById('dna-blocks-source');
            sourceArea.innerHTML = ''; // Clear previous blocks
            assembledBlocks = []; // Reset assembled blocks

            shuffledBlocks.forEach((block, index) => {
                const dnaBlock = document.createElement('div');
                dnaBlock.classList.add('dna-block', 'px-3', 'py-2', 'rounded-lg', 'bg-gray-200', 'hover:bg-gray-300', 'transition-colors', 'select-none');
                dnaBlock.textContent = block;
                dnaBlock.dataset.originalIndex = index; // Store original index
                dnaBlock.id = `block-${index}`; // Keep ID for reference
                sourceArea.appendChild(dnaBlock);

                dnaBlock.addEventListener('click', handleDnaBlockClick); // Add click listener
            });

            const targetArea = document.getElementById('dna-target-area');
            targetArea.innerHTML = '<p class="text-gray-400 text-center text-sm">Monte a sequ√™ncia aqui:</p>'; // Placeholder
            targetArea.classList.remove('border-green-500', 'border-red-500'); // Reset border color

            // Remove previous click handlers from target area and its children if any
            targetArea.removeEventListener('click', handleDnaBlockClick); // If any direct listener was added

            document.getElementById('btn-check-assembly').onclick = checkGenomeAssembly;
            document.getElementById('btn-assembly-next').classList.add('hidden');
            document.getElementById('assembly-message').textContent = '';

            // Logic for "Consultar Sequ√™ncia" button
            const showSequenceBtn = document.getElementById('btn-show-sequence');
            showSequenceBtn.onclick = () => {
                const seqDisplay = document.getElementById('original-sequence-display');
                seqDisplay.classList.remove('hidden');
                showSequenceBtn.disabled = true; // Disable button while sequence is visible

                if (sequenceDisplayTimeout) {
                    clearTimeout(sequenceDisplayTimeout);
                }
                sequenceDisplayTimeout = setTimeout(() => {
                    seqDisplay.classList.add('hidden');
                    showSequenceBtn.disabled = false; // Re-enable button
                }, 3000); // 3 seconds
            };
        }

        function checkGenomeAssembly() {
            const assembledSequence = assembledBlocks.join('');
            const originalFullSequence = originalSequenceBlocks.join('');
            const messageElement = document.getElementById('assembly-message');
            const nextButton = document.getElementById('btn-assembly-next');
            const targetArea = document.getElementById('dna-target-area');

            // Reset block colors
            targetArea.querySelectorAll('.dna-block').forEach(block => {
                block.classList.remove('correct', 'incorrect');
            });

            if (assembledSequence === originalFullSequence) {
                messageElement.textContent = 'Montagem correta! üéâ';
                messageElement.classList.remove('text-red-600');
                messageElement.classList.add('text-green-600');
                nextButton.classList.remove('hidden');

                // Mark blocks as correct
                targetArea.querySelectorAll('.dna-block').forEach(block => {
                    block.classList.add('correct');
                });

            } else {
                messageElement.textContent = 'Montagem incorreta. Tente novamente.';
                messageElement.classList.remove('text-green-600');
                messageElement.classList.add('text-red-600');
                nextButton.classList.add('hidden');

                // Provide feedback on incorrect blocks (simple, based on position)
                const targetBlocks = targetArea.querySelectorAll('.dna-block');
                for (let i = 0; i < assembledBlocks.length; i++) {
                    if (originalSequenceBlocks[i] && assembledBlocks[i] !== originalSequenceBlocks[i]) {
                        targetBlocks[i].classList.add('incorrect');
                    } else if (originalSequenceBlocks[i]) {
                        targetBlocks[i].classList.add('correct');
                    }
                }
            }
        }

        document.getElementById('btn-assembly-next').onclick = () => {
            showScreen('databaseQuery');
            startDatabaseQueryProcess(); // Start the database query automatically
        };

        // Screen: Database Query - Modified for automatic processing
        function startDatabaseQueryProcess() {
            const dbStatusText = document.getElementById('db-status-text');
            const dbProcessingArea = document.getElementById('db-processing-area');
            const nextButton = document.getElementById('btn-db-next');

            dbStatusText.textContent = 'Processando dados e comparando com registros no banco...';
            dbProcessingArea.classList.remove('bg-green-50', 'bg-red-50', 'bg-gray-50');
            dbProcessingArea.innerHTML = `
                <svg class="animate-spin h-10 w-10 text-green-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-lg text-gray-700">Buscando no banco de dados gen√¥mico...</p>
            `;
            nextButton.classList.add('hidden');

            // Simulate network request/processing time
            setTimeout(() => {
                identifiedAnimal = findAnimalBySequence(currentSequence);
                if (identifiedAnimal) {
                    dbProcessingArea.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle text-green-500 mb-4"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
                        <p class="text-lg text-green-700">Sequ√™ncia encontrada! Pronto para o alinhamento.</p>
                    `;
                    dbProcessingArea.classList.add('bg-green-50');
                    nextButton.classList.remove('hidden');
                } else {
                    dbProcessingArea.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-circle text-red-500 mb-4"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                        <p class="text-lg text-red-700">Sequ√™ncia n√£o encontrada em nosso banco. Tente outra!</p>
                    `;
                    dbProcessingArea.classList.add('bg-red-50');
                    nextButton.classList.add('hidden');
                }
            }, 3000); 
        }

        document.getElementById('btn-db-next').onclick = () => {
            showScreen('geneticAlignment');
            setupGeneticAlignment(identifiedAnimal);
        };

        // Screen: Genetic Alignment - Modified for environment-specific similarity
        function setupGeneticAlignment(animal) {
            const visualizationArea = document.getElementById('alignment-visualization');
            const summaryText = document.getElementById('alignment-summary');
            visualizationArea.innerHTML = '';
            summaryText.textContent = '';

            if (!animal || !identifiedEnvironment) {
                summaryText.textContent = 'Nenhum animal identificado ou ambiente selecionado para alinhamento.';
                return;
            }

            const animalsInSameEnvironment = speciesData[identifiedEnvironment];
            let similarSpecies = [];

            // Add the identified animal itself
            similarSpecies.push({
                name: animal.name,
                similarity: 100,
                isUserAnimal: true,
                sequence: animal.sequence
            });

            // Calculate similarity with other animals in the same environment
            animalsInSameEnvironment.forEach(otherAnimal => {
                if (otherAnimal.id !== animal.id) { 
                    const similarity = calculateSimilarity(animal.sequence, otherAnimal.sequence);
                    
                    const displayedSimilarity = Math.max(0, Math.round(similarity)); 
                    similarSpecies.push({
                        name: otherAnimal.name,
                        similarity: displayedSimilarity,
                        isUserAnimal: false,
                        sequence: otherAnimal.sequence
                    });
                }
            });

            // Sort by similarity descending
            similarSpecies.sort((a, b) => b.similarity - a.similarity);

            // Limit to top N similar species for visualization if too many
            const displayLimit = 5; 
            similarSpecies = similarSpecies.slice(0, displayLimit);


            similarSpecies.forEach(s => {
                const barContainer = document.createElement('div');
                barContainer.classList.add('flex', 'items-center', 'mb-2');
                const nameSpan = document.createElement('span');
                nameSpan.classList.add('w-40', 'text-gray-700', 'font-medium', 'text-right', 'mr-4');
                nameSpan.textContent = s.name + ':';
                barContainer.appendChild(nameSpan);

                const progressBarWrapper = document.createElement('div');
                progressBarWrapper.classList.add('flex-grow', 'bg-gray-200', 'rounded-full', 'h-4', 'overflow-hidden');
                const progressBarFill = document.createElement('div');
                progressBarFill.classList.add('h-full', 'rounded-full', 'transition-all', 'duration-1000', 'ease-out');
                progressBarFill.style.width = `${s.similarity}%`;
                progressBarFill.style.backgroundColor = s.isUserAnimal ? '#4CAF50' : '#2196F3'; 
                progressBarWrapper.appendChild(progressBarFill);
                barContainer.appendChild(progressBarWrapper);

                const percentageSpan = document.createElement('span');
                percentageSpan.classList.add('ml-4', 'text-gray-700', 'font-bold', 'w-12');
                percentageSpan.textContent = `${s.similarity.toFixed(0)}%`; 
                barContainer.appendChild(percentageSpan);

                visualizationArea.appendChild(barContainer);
            });

            summaryText.textContent = `O sistema encontrou que sua sequ√™ncia √© ${animal.similarity || 100}% similar √† esp√©cie ${animal.name}, indicando um forte parentesco gen√©tico. Explore outras similaridades abaixo!`;
        }

        document.getElementById('btn-alignment-next').onclick = () => {
            showScreen('identificationCard');
            displayIdentificationCard(identifiedAnimal);
        };

        // Screen: Identification Card
        function displayIdentificationCard(animal) {
            if (!animal) return;

            document.getElementById('card-animal-name').textContent = `${animal.name} (${animal.scientificName})`;
            document.getElementById('card-animal-image').src = animal.image;
            document.getElementById('card-animal-image').onerror = function () { this.src = 'https://placehold.co/200x200/CCCCCC/666666?text=Imagem+N/A'; }; // Fallback image
            document.getElementById('card-description').textContent = animal.description;
            document.getElementById('card-habitat').textContent = animal.habitat;
            document.getElementById('card-genetic-features').textContent = animal.geneticFeatures;
            document.getElementById('card-curiosity').textContent = animal.curiosity;

            // Taxonomy
            document.getElementById('card-taxonomy-kingdom').textContent = animal.taxonomy.kingdom;
            document.getElementById('card-taxonomy-phylum').textContent = animal.taxonomy.phylum;
            document.getElementById('card-taxonomy-class').textContent = animal.taxonomy.class;
            document.getElementById('card-taxonomy-order').textContent = animal.taxonomy.order;
            document.getElementById('card-taxonomy-family').textContent = animal.taxonomy.family;
            document.getElementById('card-taxonomy-genus').textContent = animal.taxonomy.genus;
            document.getElementById('card-taxonomy-species').textContent = animal.taxonomy.species;
        }

        document.getElementById('btn-identify-another').onclick = () => {
            // Reset game state and go back to QR scan screen
            currentSequence = '';
            identifiedAnimal = null;
            identifiedEnvironment = null;
            window.history.pushState({}, document.title, window.location.pathname); 
            showScreen('scanQr');
        };

        // Privacy Policy Modal Logic
        const privacyModal = document.getElementById('privacy-modal');
        const privacyLink = document.getElementById('privacy-policy-link');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalUnderstoodBtn = document.getElementById('modal-understood-btn');

        privacyLink.addEventListener('click', (e) => {
            e.preventDefault(); // Prevent default link behavior
            privacyModal.classList.remove('hidden');
        });

        modalCloseBtn.addEventListener('click', () => {
            privacyModal.classList.add('hidden');
        });

        modalUnderstoodBtn.addEventListener('click', () => {
            privacyModal.classList.add('hidden');
        });

        // Close modal if click outside content (optional)
        privacyModal.addEventListener('click', (e) => {
            if (e.target === privacyModal) {
                privacyModal.classList.add('hidden');
            }
        });

        async function initializeApp() {

            try {
                const response = await fetch('animals.json');
                if (!response.ok) {
                    throw new Error(`Erro ao buscar o arquivo: ${response.statusText}`);
                }
                speciesData = await response.json();
                console.log("Dados dos animais carregados com sucesso!");
            } catch (error) {
                console.error("N√£o foi poss√≠vel carregar os dados dos animais:", error);

                document.querySelector('main').innerHTML = `
                <div class="text-center text-red-600">
                    <h2 class="text-2xl font-bold mb-4">Erro Cr√≠tico</h2>
                    <p>N√£o foi poss√≠vel carregar os dados dos animais. Verifique o console para mais detalhes e tente recarregar a p√°gina.</p>
                </div>`;
                return;
            }


            const params = getQueryParams();
            if (params.seq) {
                currentSequence = params.seq.toUpperCase();
                showScreen('introSequence');
            } else {
                showScreen('home');
            }
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>

</html>